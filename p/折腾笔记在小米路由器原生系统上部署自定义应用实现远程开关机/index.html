<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='起因：远程开关机的需求 笔者6月初组了台式，并将主机置于角落，按下物理的开关键变得很麻烦，因此有了远程开关机的需求。 经过了解后，发现远程开关机有三种方式：
主板通电开机 + 智能插座物理断电关机 安装 PCIe 开机卡 Wake On Lan + SSH关机 智能插座 开机 现代主板都有来电自启动这个功能，开启之后，搭配智能插座的远程通断电功能，如米家插座，就可以远程开机了。
智能插座一般都依赖于路由器提供Wi-Fi，以接入物联网 Internet of Things(IoT) 软件 关机 通过智能插座的物理断电以强制关机。
优缺点
实现简单：只需要购买智能插座和开启主板的来电自启 花费：¥40 智能插座 开机慢： 主板在通电后首次开机，自检项目很多，导致开机时间被延长 断电关机有风险：如果在传输数据过程中关机，操作系统可能会来不及保存数据而造成文件损坏 向日葵智能插座提供了软关机的方式，但需要后台运行向日葵监控软件 PCIe 开机卡 按下机箱上的开机键，会让电脑开关机，其本质就是短接下主板的 power on/off 针脚，而接入 PCIe 开机卡则是能够通过 IoT 软件中发出开关机的指令。
接入 PCIe 开机卡，同样需要路由器提供Wi-Fi，才能接入 IoT 软件。
优缺点
规避了物理通断电的缺点 会占用主板上的 PCIe 槽，虽然不会抢带宽 花费：¥40 PCIe 开机卡 部分厂商无法接入米家 Wake On Lan + SSH关机 开机：网络唤醒 Wake on LAN (WoL)，设备通过局域网向目标主机的网卡发送指令，网卡就会通知所在主板开机。 关机：设备通过SSH远程登录指定主机，然后执行关机指令。
优缺点：
需要额外的且24h 运行的设备 如果能够解锁路由器的SSH，就可以用路由器充当这个设备。否则需要考虑 NAS，软路由等。 实现麻烦： 开启 WoL，需要调整主板，系统内的设置，SSH 远程指令，更是大坑 花费：¥0，现有设备，才应该考虑这个方案。 出于折腾和省钱的目的，笔者选择了第三种方案。'><title>折腾笔记：在小米路由器原生系统上部署自定义应用，实现远程开关机</title>
<link rel=canonical href=https://niluan304.github.io/p/%E6%8A%98%E8%85%BE%E7%AC%94%E8%AE%B0%E5%9C%A8%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8%E5%8E%9F%E7%94%9F%E7%B3%BB%E7%BB%9F%E4%B8%8A%E9%83%A8%E7%BD%B2%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BA%94%E7%94%A8%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%85%B3%E6%9C%BA/><link rel=stylesheet href=/scss/style.min.545a4bdeec1c4e1219ce37a5aa3c203d9c43cc628e61f46f1be508672511f8d8.css><meta property='og:title' content='折腾笔记：在小米路由器原生系统上部署自定义应用，实现远程开关机'><meta property='og:description' content='起因：远程开关机的需求 笔者6月初组了台式，并将主机置于角落，按下物理的开关键变得很麻烦，因此有了远程开关机的需求。 经过了解后，发现远程开关机有三种方式：
主板通电开机 + 智能插座物理断电关机 安装 PCIe 开机卡 Wake On Lan + SSH关机 智能插座 开机 现代主板都有来电自启动这个功能，开启之后，搭配智能插座的远程通断电功能，如米家插座，就可以远程开机了。
智能插座一般都依赖于路由器提供Wi-Fi，以接入物联网 Internet of Things(IoT) 软件 关机 通过智能插座的物理断电以强制关机。
优缺点
实现简单：只需要购买智能插座和开启主板的来电自启 花费：¥40 智能插座 开机慢： 主板在通电后首次开机，自检项目很多，导致开机时间被延长 断电关机有风险：如果在传输数据过程中关机，操作系统可能会来不及保存数据而造成文件损坏 向日葵智能插座提供了软关机的方式，但需要后台运行向日葵监控软件 PCIe 开机卡 按下机箱上的开机键，会让电脑开关机，其本质就是短接下主板的 power on/off 针脚，而接入 PCIe 开机卡则是能够通过 IoT 软件中发出开关机的指令。
接入 PCIe 开机卡，同样需要路由器提供Wi-Fi，才能接入 IoT 软件。
优缺点
规避了物理通断电的缺点 会占用主板上的 PCIe 槽，虽然不会抢带宽 花费：¥40 PCIe 开机卡 部分厂商无法接入米家 Wake On Lan + SSH关机 开机：网络唤醒 Wake on LAN (WoL)，设备通过局域网向目标主机的网卡发送指令，网卡就会通知所在主板开机。 关机：设备通过SSH远程登录指定主机，然后执行关机指令。
优缺点：
需要额外的且24h 运行的设备 如果能够解锁路由器的SSH，就可以用路由器充当这个设备。否则需要考虑 NAS，软路由等。 实现麻烦： 开启 WoL，需要调整主板，系统内的设置，SSH 远程指令，更是大坑 花费：¥0，现有设备，才应该考虑这个方案。 出于折腾和省钱的目的，笔者选择了第三种方案。'><meta property='og:url' content='https://niluan304.github.io/p/%E6%8A%98%E8%85%BE%E7%AC%94%E8%AE%B0%E5%9C%A8%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8%E5%8E%9F%E7%94%9F%E7%B3%BB%E7%BB%9F%E4%B8%8A%E9%83%A8%E7%BD%B2%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BA%94%E7%94%A8%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%85%B3%E6%9C%BA/'><meta property='og:site_name' content='雾封的笔'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2024-06-16T23:53:49+08:00'><meta property='article:modified_time' content='2024-06-16T23:53:49+08:00'><meta name=twitter:title content="折腾笔记：在小米路由器原生系统上部署自定义应用，实现远程开关机"><meta name=twitter:description content="起因：远程开关机的需求 笔者6月初组了台式，并将主机置于角落，按下物理的开关键变得很麻烦，因此有了远程开关机的需求。 经过了解后，发现远程开关机有三种方式：
主板通电开机 + 智能插座物理断电关机 安装 PCIe 开机卡 Wake On Lan + SSH关机 智能插座 开机 现代主板都有来电自启动这个功能，开启之后，搭配智能插座的远程通断电功能，如米家插座，就可以远程开机了。
智能插座一般都依赖于路由器提供Wi-Fi，以接入物联网 Internet of Things(IoT) 软件 关机 通过智能插座的物理断电以强制关机。
优缺点
实现简单：只需要购买智能插座和开启主板的来电自启 花费：¥40 智能插座 开机慢： 主板在通电后首次开机，自检项目很多，导致开机时间被延长 断电关机有风险：如果在传输数据过程中关机，操作系统可能会来不及保存数据而造成文件损坏 向日葵智能插座提供了软关机的方式，但需要后台运行向日葵监控软件 PCIe 开机卡 按下机箱上的开机键，会让电脑开关机，其本质就是短接下主板的 power on/off 针脚，而接入 PCIe 开机卡则是能够通过 IoT 软件中发出开关机的指令。
接入 PCIe 开机卡，同样需要路由器提供Wi-Fi，才能接入 IoT 软件。
优缺点
规避了物理通断电的缺点 会占用主板上的 PCIe 槽，虽然不会抢带宽 花费：¥40 PCIe 开机卡 部分厂商无法接入米家 Wake On Lan + SSH关机 开机：网络唤醒 Wake on LAN (WoL)，设备通过局域网向目标主机的网卡发送指令，网卡就会通知所在主板开机。 关机：设备通过SSH远程登录指定主机，然后执行关机指令。
优缺点：
需要额外的且24h 运行的设备 如果能够解锁路由器的SSH，就可以用路由器充当这个设备。否则需要考虑 NAS，软路由等。 实现麻烦： 开启 WoL，需要调整主板，系统内的设置，SSH 远程指令，更是大坑 花费：¥0，现有设备，才应该考虑这个方案。 出于折腾和省钱的目的，笔者选择了第三种方案。"><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-C0BX1J3KRG"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-C0BX1J3KRG",{anonymize_ip:!1})}</script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Noto+Serif+HK:wght@300;400;500;600;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hueb4763c82ba1420a58a50c6eccfe357b_472983_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>☕</span></figure><div class=site-meta><h1 class=site-name><a href=/>雾封的笔</a></h1><h2 class=site-description>脚步不停，灿若繁星。</h2></div></header><ol class=social-menu><li><a href=mailto:zwei.elen@outlook.com target=_blank title=Email rel=me><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="#2c3e50" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icon-tabler-mail" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="m3 7 9 6 9-6"/></svg></a></li><li><a href=https://github.com/niluan304 target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/solutions/><!doctype html><svg t="1710685833984" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="19816" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M624.289 816.93c-3.032.0-6.157.409-9.288 1.214-72.38 18.637-144.767 37.274-217.147 55.897-19.536 5.03-26.426 21.93-24.586 36.448 1.981 15.646 14.106 31.485 33.446 31.485h.002c3.029.0 6.15-.407 9.28-1.212a2055574.5 2055574.5.0 01217.149-55.898c19.536-5.034 26.423-21.938 24.583-36.457-1.985-15.642-14.106-31.476-33.44-31.476zM572.377 934.011c-6.321.0-12.516 2.06-18.413 6.126-14.42 9.939-28.264 15.35-41.153 16.086-.547.032-1.095.047-1.644.047-6.968.0-14.874-2.326-24.868-7.31-.743-.393-3.643-2.292-5.561-3.547-5.306-3.474-6.786-4.443-8.492-4.674-5.036-2.597-10.51-3.946-16.135-3.946-15.808.0-30.932 10.543-35.963 25.07-4.172 12.041-.206 24.313 10.609 32.827 24.347 19.168 52.743 29.3 82.12 29.3 26.81.0 53.386-8.55 76.855-24.725 13.26-9.139 18.484-24.493 13.637-40.068-4.69-15.065-17.144-25.186-30.992-25.186zM758.2 323.388c-23.674-44.276-59.272-80.43-102.949-104.556-40.902-22.593-88.289-34.536-137.036-34.536-41.49.0-83.246 8.797-120.754 25.442-39.792 17.658-73.83 43.216-101.172 75.963-51.182 61.3-72.758 149.987-57.716 237.237 14.454 83.839 60.433 154.192 126.145 193.017 5.63 3.328 11.493 5.015 17.423 5.015 15.057.0 28.606-11.094 32.946-26.978 4.146-15.17-1.767-29.61-15.431-37.682-87.857-51.928-112.807-177.156-85.54-263.399 26.457-83.656 107.442-139.862 201.52-139.862 39.74.0 78.37 10.246 111.716 29.63 45.121 26.234 77.406 69.951 90.905 123.098 14.556 57.308 5.738 118.382-24.192 167.566-11.93 19.606-27.417 37.625-42.396 55.048-9.603 11.173-19.533 22.724-28.549 34.697-15.429 20.492-20.147 42.395-24.71 63.575-.8 3.718-1.62 7.528-2.499 11.339l-198.107 52.663c-19.536 5.193-26.361 22.222-24.458 36.791 2.024 15.5 14.071 31.193 33.179 31.196h.007c3.103.0 6.304-.433 9.517-1.286 51.509-13.699 103.021-27.39 154.534-41.075 5.775-1.536 11.35-2.909 16.74-4.24 42.26-10.416 75.638-18.644 79.547-79.646 1.383-21.58 19.882-41.685 36.204-59.424 4.189-4.553 8.144-8.853 11.756-13.099 19.584-23.002 44.049-54.132 59.531-90.99 32.646-77.76 26.907-164.947-16.16-245.504zM173.191 470.702c0-19.056-15.448-34.504-34.505-34.504H71.708c-19.057.0-34.505 15.448-34.505 34.504.0 19.057 15.448 34.505 34.505 34.505h66.978c19.057.0 34.505-15.448 34.505-34.505zm781.798-34.504h-66.98c-19.056.0-34.503 15.448-34.503 34.504.0 19.057 15.448 34.505 34.504 34.505h66.979c19.056.0 34.505-15.448 34.505-34.505.0-19.056-15.449-34.504-34.505-34.504zM225.263 230.175c13.475 13.475 35.321 13.475 48.796.0s13.475-35.322.0-48.796l-47.362-47.362c-13.474-13.475-35.321-13.475-48.796.0s-13.475 35.321.0 48.796l47.362 47.362zM803.912 711.23c-13.475-13.475-35.322-13.475-48.797.0-13.474 13.475-13.474 35.322.0 48.797l47.362 47.362c13.475 13.475 35.322 13.475 48.796.0 13.475-13.475 13.475-35.321.0-48.797l-47.361-47.362zM514.587 135.988c19.056.0 34.505-15.449 34.505-34.505v-66.98C549.092 15.449 533.643.0 514.587.0c-19.057.0-34.505 15.449-34.505 34.505v66.979c0 19.056 15.448 34.505 34.505 34.505zM274.06 711.23c-13.475-13.475-35.321-13.475-48.796.0l-47.362 47.362c-13.475 13.475-13.475 35.321.0 48.797 13.475 13.475 35.322 13.475 48.796.0l47.362-47.362c13.475-13.475 13.475-35.322.0-48.797zM755.114 230.175c13.475 13.475 35.322 13.475 48.797.0l47.361-47.362c13.475-13.475 13.475-35.321.0-48.796s-35.321-13.475-48.796.0l-47.362 47.362c-13.474 13.474-13.474 35.321.0 48.796z" fill="#707070" p-id="19817" data-spm-anchor-id="a313x.search_index.0.i7.774c3a81Q659h0" class="selected"/></svg>
<span>Solutions</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#起因远程开关机的需求>起因：远程开关机的需求</a><ol><li><a href=#智能插座>智能插座</a></li><li><a href=#pcie-开机卡>PCIe 开机卡</a></li><li><a href=#wake-on-lan--ssh关机>Wake On Lan + SSH关机</a></li></ol></li><li><a href=#警告>警告</a></li><li><a href=#前期准备>前期准备</a><ol><li><a href=#注册巴法云账号>注册巴法云账号</a></li><li><a href=#为受控电脑安装-ssh-服务>为受控电脑安装 SSH 服务</a><ol><li><a href=#windows>Windows</a></li><li><a href=#linux>Linux</a></li></ol></li><li><a href=#开启受控电脑的-wake-on-lan>开启受控电脑的 Wake On Lan</a><ol><li><a href=#开启主板的-wol>开启主板的 WoL</a></li><li><a href=#关闭主板的电源节能设置>关闭主板的电源节能设置</a></li><li><a href=#windows-系统设置>windows 系统设置</a></li></ol></li></ol></li><li><a href=#部署-pc>部署 pc</a><ol><li><a href=#开启设备的-sshtelnet>开启设备的 <code>SSH</code>/<code>Telnet</code></a></li><li><a href=#下载-pc>下载 <code>pc</code></a></li><li><a href=#修改配置文件>修改配置文件</a></li><li><a href=#调试-pc>调试 <code>pc</code></a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E6%8A%98%E8%85%BE%E7%AC%94%E8%AE%B0%E5%9C%A8%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8%E5%8E%9F%E7%94%9F%E7%B3%BB%E7%BB%9F%E4%B8%8A%E9%83%A8%E7%BD%B2%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BA%94%E7%94%A8%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%85%B3%E6%9C%BA/>折腾笔记：在小米路由器原生系统上部署自定义应用，实现远程开关机</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2024-06-16</time></div></footer></div></header><section class=article-content><h2 id=起因远程开关机的需求>起因：远程开关机的需求</h2><p>笔者6月初组了台式，并将主机置于角落，按下物理的开关键变得很麻烦，因此有了远程开关机的需求。
经过了解后，发现远程开关机有三种方式：</p><ul><li>主板通电开机 + 智能插座物理断电关机</li><li>安装 PCIe 开机卡</li><li>Wake On Lan + SSH关机</li></ul><h3 id=智能插座>智能插座</h3><ul><li><p>开机
现代主板都有来电自启动这个功能，开启之后，搭配智能插座的远程通断电功能，如米家插座，就可以远程开机了。</p><ul><li>智能插座一般都依赖于路由器提供Wi-Fi，以接入物联网 Internet of Things(IoT) 软件</li></ul></li><li><p>关机
通过智能插座的物理断电以强制关机。</p></li><li><p>优缺点</p><ul><li>实现简单：只需要购买智能插座和开启主板的来电自启</li><li>花费：¥40 智能插座</li><li>开机慢： 主板在通电后首次开机，自检项目很多，导致开机时间被延长</li><li>断电关机有风险：如果在传输数据过程中关机，操作系统可能会来不及保存数据而造成文件损坏<ul><li>向日葵智能插座提供了软关机的方式，但需要后台运行向日葵监控软件</li></ul></li></ul></li></ul><h3 id=pcie-开机卡>PCIe 开机卡</h3><p>按下机箱上的开机键，会让电脑开关机，其本质就是短接下主板的 power on/off 针脚，而接入 PCIe 开机卡则是能够通过 IoT 软件中发出开关机的指令。</p><ul><li><p>接入 PCIe 开机卡，同样需要路由器提供Wi-Fi，才能接入 IoT 软件。</p></li><li><p>优缺点</p><ul><li>规避了物理通断电的缺点</li><li>会占用主板上的 PCIe 槽，虽然不会抢带宽</li><li>花费：¥40 PCIe 开机卡</li><li>部分厂商无法接入米家</li></ul></li></ul><h3 id=wake-on-lan--ssh关机>Wake On Lan + SSH关机</h3><p>开机：网络唤醒 Wake on LAN (WoL)，设备通过局域网向目标主机的网卡发送指令，网卡就会通知所在主板开机。
关机：设备通过SSH远程登录指定主机，然后执行关机指令。</p><p>优缺点：</p><ul><li>需要额外的且24h 运行的设备<ul><li>如果能够解锁路由器的SSH，就可以用路由器充当这个设备。否则需要考虑 NAS，软路由等。</li></ul></li><li>实现麻烦：<ul><li>开启 WoL，需要调整主板，系统内的设置，SSH 远程指令，更是大坑</li></ul></li><li>花费：¥0，现有设备，才应该考虑这个方案。</li></ul><p>出于折腾和省钱的目的，笔者选择了第三种方案。</p><h2 id=警告>警告</h2><ol><li>刷机，乃至于开启 <code>SSH</code>都有可能失去官方保修，请谨慎操作</li><li>小米路由器开启<code>SSH</code> 对系统版本有要求，新版本固件很可能不支持开启<code>SSH</code></li></ol><h2 id=前期准备>前期准备</h2><h3 id=注册巴法云账号>注册巴法云账号</h3><p>注册一个巴法云账户，并添加一个<code>006</code>后缀的主题。</p><blockquote><p>可参考：<a class=link href=https://cloud.bemfa.com/docs/src/index_guild.html target=_blank rel=noopener>平台操作教程 | 巴法文档中心</a></p></blockquote><p>步骤如下：</p><ol><li>打开 <a class=link href=https://cloud.bemfa.com/ target=_blank rel=noopener>巴法物联网云平台</a>，使用邮箱或手机注册。</li><li>点击「控制台」，拷贝自己的私钥，后续会用到。</li><li>新建主题-命名为 <code>pc006</code>，名称可以为任意英文，但必须以<code>006</code>结尾，表示开关设备。</li></ol><p>效果如图：
<img src=https://github.com/niluan304/picx-images-hosting/raw/master/pc/bemfa_init.4jo078gpsw.webp loading=lazy alt="bemfa init"></p><ul><li>点击「昵称」，网页会弹出「修改昵称」的窗口，以供自定义。</li></ul><h3 id=为受控电脑安装-ssh-服务>为受控电脑安装 SSH 服务</h3><h4 id=windows>Windows</h4><p>具体的安装方法请参考：<a class=link href=https://www.sysgeek.cn/openssh-windows/ target=_blank rel=noopener>Windows 上的 OpenSSH：安装、配置和使用指南 - 系统极客</a></p><p>在开始安装 OpenSSH 之前，请确保你的电脑满足以下条件：</p><ul><li><strong>操作系统</strong>：Windows 11 或 Windows 10（1809 版本或更高）。</li><li><strong>PowerShell 版本</strong>：PowerShell 5.1 或以上。</li><li><strong>管理员权限</strong>：安装 OpenSSH 需要拥有管理员权限。</li></ul><h4 id=linux>Linux</h4><p>Linux 电脑一般都安装 <code>OpenSSH</code>，如果没有可以通过各发行版的包管理工具安装：</p><ul><li><p><code>Debian</code> 、<code>Ubuntu</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install ssh
</span></span></code></pre></div></li><li><p><code>CentOs</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo yum install openssh-server
</span></span></code></pre></div></li></ul><h3 id=开启受控电脑的-wake-on-lan>开启受控电脑的 Wake On Lan</h3><h4 id=开启主板的-wol>开启主板的 WoL</h4><p>想要使用网络唤醒（Wake-on-LAN，WoL），也需要开启主板BIOS的 WoL 功能，各厂商的主板开启方式不一致，具体方法视厂商而定，进入 BIOS 后注意选项附加的说明即可，可以参考的关键词包括：</p><ul><li>Automatic Power On</li><li>Wake on LAN/WLAN</li><li>Power Management</li><li>Power On by Onboard LAN</li><li>Power On by PCI-E Devices</li></ul><h4 id=关闭主板的电源节能设置>关闭主板的电源节能设置</h4><p>很多厂商的主板都有低功耗模式，为了节能，该模式下，电脑关机后，会彻底关闭网卡，会无法使用 WoL ，因此需要关闭此类模式。可以参考的关键词包括：</p><ul><li>ErP</li><li>EUP</li></ul><h4 id=windows-系统设置>windows 系统设置</h4><h5 id=配置网卡>配置网卡</h5><ol><li><p>在 Windows 10 中，<code>运行 > ncpa.cpl</code> 打开「网络连接」设置，然后找到当前在使用的有线网卡，右键点击「属性」：</p><img src=https://github.com/niluan304/picx-images-hosting/raw/master/pc/image.99tal6cv72.webp alt=image-20240723000140265 style=zoom:50%></li><li><p>点击「配置」：</p><img src=https://github.com/niluan304/picx-images-hosting/raw/master/pc/image.ic28dhbz7.webp alt=image-20240723000220472 style=zoom:50%></li><li><p>切换到「电源管理」，勾选「允许此设备唤醒计算机」以及「只允许幻数据包唤醒计算机」：</p><img src=https://github.com/niluan304/picx-images-hosting/raw/master/pc/image.4cktrbzer5.webp alt=image-20240722235715931 style=zoom:50%></li></ol><h5 id=关闭快速启动>关闭快速启动</h5><img src=https://github.com/niluan304/picx-images-hosting/raw/master/pc/image.13lpuoc0gk.webp alt=image-20240901234515640 style=zoom:50%><ol><li>先点击「更改当前不可用的设置」，以便能修改关机设置</li><li>关闭「启用快速启动」（快速启动（Fast Startup），属于 S4 电源状态，不支持网络唤醒）</li></ol><h2 id=部署-pc>部署 pc</h2><p>笔者编写了一个小应用（下文称为 <code>pc</code>），依赖于 WakeOnLan、巴法云和SSH协议，实现了远程开关机：</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>sequenceDiagram
	actor user AS 用户
	participant iot AS iot(小爱同学)
	participant bemfa AS 巴法云
    participant power AS pc
	participant pc AS 电脑

	rect rgb(191, 223, 255)
	Note over user,pc: 远程关机
	user -&gt;&gt;+ iot: 语音：关电脑
	iot -&gt;&gt; bemfa: 推送消息：&#34;off&#34;
	bemfa -&gt;&gt; power: TCP(&#34;off&#34;)
	power -&gt;&gt; pc: SSH(&#34;关机&#34;)
	pc -&gt;&gt; pc: 关机
	iot --)- user: ok（异步）
    end
    
	rect rgb(248,240,233)
	Note over user,pc: 远程开机
    user -&gt;&gt;+ iot: 语音：开电脑
	iot -&gt;&gt; bemfa: 推送消息：&#34;on&#34;
	bemfa -&gt;&gt; power: TCP(&#34;on&#34;)
	power -&gt;&gt; pc: WoL &amp; SSH(&#34;取消关机&#34;)
	pc -&gt;&gt; pc: 开机
	iot --)- user: ok（异步）
    end
</code></pre><h3 id=开启设备的-sshtelnet>开启设备的 <code>SSH</code>/<code>Telnet</code></h3><p><code>pc</code> 需要运行在局域网内不停机的机器上，如路由器、NAS。</p><p>因此需要能登录到目标机器上，然后下载并运行<code>pc</code>。最常用的远程登录协议为 <code>SSH</code>，搭配 <code>SCP</code> 操作文件系统也会更方便。</p><ul><li>某些设备<strong>只能启用 <code>Telnet</code> 协议</strong>，无法启用 <code>SSH</code> ，操作会繁琐一些。</li></ul><p>以笔者的小米路由器 AX3000T（1.0.47版本下）为例，开启<code>SSH</code>的步骤：</p><ol><li><p>登录路由器后台，复制 <code>stok</code>变量</p><p><img src=https://github.com/niluan304/picx-images-hosting/raw/master/pc/image.45mhiacft.png loading=lazy alt=image-20240727194218564></p></li><li><p>将脚本内容保存到 <code>stok.bat</code> 文件中，执行后并输入复制的<code>stok</code>变量，</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bat data-lang=bat><span class=line><span class=cl><span class=p>@</span><span class=c1>REM 使用 UTF8 编码，以正确显示中文</span>
</span></span><span class=line><span class=cl>chcp 65001
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>echo</span> off
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=c1>REM  &lt;STOK&gt;修改为复制的变量</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> Input the <span class=se>^&lt;</span>STOK<span class=se>^&gt;</span> in admin page of your Xiaomi router
</span></span><span class=line><span class=cl><span class=k>echo</span> 输入你小米路由器中后台页面中的 <span class=se>^&lt;</span>STOK<span class=se>^&gt;</span>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=k>/p</span> <span class=nv>STOK</span><span class=p>=</span>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=c1>REM echo %STOK%</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl -X POST http://192.168.31.1/cgi-bin/luci/;stok=<span class=nv>%STOK%</span>/api/misystem/arn_switch -d <span class=s2>&#34;open=1&amp;model=1&amp;level=</span><span class=nv>%0</span><span class=s2>Anvram</span><span class=nv>%2</span><span class=s2>0set</span><span class=nv>%2</span><span class=s2>0ssh_en</span><span class=nv>%3</span><span class=s2>D1</span><span class=nv>%0</span><span class=s2>A&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl -X POST http://192.168.31.1/cgi-bin/luci/;stok=<span class=nv>%STOK%</span>/api/misystem/arn_switch -d <span class=s2>&#34;open=1&amp;model=1&amp;level=</span><span class=nv>%0</span><span class=s2>Anvram</span><span class=nv>%2</span><span class=s2>0commit</span><span class=nv>%0</span><span class=s2>A&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl -X POST http://192.168.31.1/cgi-bin/luci/;stok=<span class=nv>%STOK%</span>/api/misystem/arn_switch -d <span class=s2>&#34;open=1&amp;model=1&amp;level=</span><span class=nv>%0</span><span class=s2>Ased</span><span class=nv>%2</span><span class=s2>0-i</span><span class=nv>%2</span><span class=s2>0&#39;s</span><span class=nv>%2</span><span class=s2>Fchannel</span><span class=nv>%3</span><span class=s2>D.*</span><span class=nv>%2</span><span class=s2>Fchannel</span><span class=nv>%3</span><span class=s2>D</span><span class=nv>%2</span><span class=s2>2debug</span><span class=nv>%2</span><span class=s2>2</span><span class=nv>%2</span><span class=s2>Fg&#39;</span><span class=nv>%2</span><span class=s2>0</span><span class=nv>%2</span><span class=s2>Fetc</span><span class=nv>%2</span><span class=s2>Finit.d</span><span class=nv>%2</span><span class=s2>Fdropbear</span><span class=nv>%0</span><span class=s2>A&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl -X POST http://192.168.31.1/cgi-bin/luci/;stok=<span class=nv>%STOK%</span>/api/misystem/arn_switch -d <span class=s2>&#34;open=1&amp;model=1&amp;level=</span><span class=nv>%0</span><span class=s2>A</span><span class=nv>%2</span><span class=s2>Fetc</span><span class=nv>%2</span><span class=s2>Finit.d</span><span class=nv>%2</span><span class=s2>Fdropbear</span><span class=nv>%2</span><span class=s2>0start</span><span class=nv>%0</span><span class=s2>A&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>pause</span>
</span></span></code></pre></div><p>效果大概是这样的：</p><p><img src=https://github.com/niluan304/picx-images-hosting/raw/master/pc/image.77dhx4di50.webp loading=lazy alt=image-20240805002207392></p><ul><li>也可以逐行复制到 cmd 执行，可参考：<a class=link href=https://mao.fan/article/102 target=_blank rel=noopener>小米AX3000T解锁SSH ＆固化SSH</a></li></ul></li></ol><h3 id=下载-pc>下载 <code>pc</code></h3><p>根据设备的芯片架构及安装的操作系统，找到对应的压缩包：<a class=link href=https://github.com/niluan304/pc/releases/ target=_blank rel=noopener>Release</a></p><p>如果是 Linux/OpenWrt 系统，可以在命令行输入 <code>cat /etc/os-release | grep ARCH</code> 以查看设备的架构，以笔者的为例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /etc/os-release <span class=p>|</span> grep ARCH
</span></span><span class=line><span class=cl><span class=nv>LEDE_ARCH</span><span class=o>=</span><span class=s2>&#34;aarch64_cortex-a53&#34;</span> <span class=c1># cortex-a53 是 实现ARMv8-A 64位指令集的微架构，故 CPU 是 arm64架构的</span>
</span></span></code></pre></div><p>在目标设备中，将解压后的二进制文件及配置文件移动到可读写的文件夹，实现方式有两种：</p><ul><li>直接通过 <code>curl</code> 或 <code>wget</code> 命令下载压缩包后解压</li><li>在其他设备上下载后，通过 <code>scp</code> 等协议上传到设备</li></ul><h3 id=修改配置文件>修改配置文件</h3><p><code>pc</code> 使用 <code>yaml</code>文件作为配置文件，使用前，使用者应当熟悉一下 <code>yaml</code> 的基本语法，以修改或补全空白配置项的值：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># 当前程序所在主机的局域网IP，即通过 SSH/Telnet 登录的设备，一般为路由器/NAS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 小米路由器的局域网IP一般为：192.168.31.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>myIP</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 目标主机的主板网卡MAC地址，</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># windows 机器可以在命令行中输入 `ipconfig /all` 查看，如：00-1B-44-11-3A-B7</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>targetMac</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># ssh 配置</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>ssh</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># 目标主机的 IP + SSH 端口号</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># host:port 如 192.168.31.111:11022</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>addr</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># 用户名，目前支持私钥和密码登录</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># 私钥路径，建议使用绝对地</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># 通过公私钥登录，推荐使用</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># 私钥可通过其他设备上的 `ssh-keygen -t ed25519 -f ed25519` 命令生成</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># 然后将 ed25519 私钥上传至运行设备上</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>identity</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># 使用密码登录，可选项</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># 密码明文，应当在局域网环境使用</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 日志设置</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>log</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># 日志文件位置，默认为 pc.log</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/log/pc.log</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># 是否打印代码位置</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>addSource</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># 日志级别</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># 定义见 log/slog/level.go:43</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># LevelDebug Level = -4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># LevelInfo  Level = 0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># LevelWarn  Level = 4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># LevelError Level = 8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>bemfa</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># 巴法云的 UID，即控制台的私钥</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>uid</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c># topic-switch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>switch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 主题的名称</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>topic</span><span class=p>:</span><span class=w> </span><span class=l>XXX006</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Switch 只接收 on/off 两种指令，对应的操作</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 覆盖这里的指令之前，你应该在默认的 shell，Linux(sh)/Windows(cmd) 中测试一下，以确保关机指令和取消指令是正确的。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=l>cmd /c shutdown /a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>off</span><span class=p>:</span><span class=w> </span><span class=l>cmd /c shutdown /s /t 600</span><span class=w>
</span></span></span></code></pre></div><h3 id=调试-pc>调试 <code>pc</code></h3><ol><li><p>运行 <code>pc</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Linux 机器上，赋予 `pc` 执行权限</span>
</span></span><span class=line><span class=cl>chmod +x pc
</span></span><span class=line><span class=cl><span class=c1># 指定配置文件并运行</span>
</span></span><span class=line><span class=cl>./pc -config config.yml
</span></span></code></pre></div></li><li><p>通过巴法云推送消息</p><p>在巴法云控制台，如果连接正常，<code>pc</code> 订阅的主题上，会显示订阅者的在线数量：
<img src=https://github.com/niluan304/picx-images-hosting/raw/master/pc/topic.8ojljeijjj.webp loading=lazy></p><ul><li><p>设备（Windows）处于开机状态</p><ul><li>推送 <code>off</code>，弹窗显示，即将关机：<br><img src=https://github.com/niluan304/picx-images-hosting/raw/master/pc/switch-off.7zqbzd7e3r.webp loading=lazy></li><li>推送 <code>on</code>，弹窗显示，关机被取消：<br><img src=https://github.com/niluan304/picx-images-hosting/raw/master/pc/switch-on.3d4oyo8ug8.webp loading=lazy></li></ul></li><li><p>设备处于关机机状态</p><ul><li>推送 <code>off</code>，设备无反应</li><li>推送 <code>on</code>，设备 <strong>开机</strong></li></ul></li></ul></li><li><p>后台运行 <code>pc</code>
若调试后无问题，即可在设备上后台运行 <code>pc</code>, 以捕获巴法云的消息推送</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./pc -config config.yml <span class=p>&amp;</span>
</span></span></code></pre></div></li><li><p>巴法云接入 iot 软件</p><ul><li>米家：</li><li><img src=https://github.com/niluan304/picx-images-hosting/raw/master/pc/iot-mijia.lvmqmxpuf.webp loading=lazy></li></ul></li></ol></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://fastly.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://fastly.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><script src=//cdn.jsdelivr.net/npm/twikoo@1.6.32/dist/twikoo.all.min.js></script><div id=tcomment></div><style>.twikoo{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}:root[data-scheme=dark]{--twikoo-body-text-color-main:rgba(255, 255, 255, 0.9);--twikoo-body-text-color:rgba(255, 255, 255, 0.7)}.twikoo .el-input-group__prepend,.twikoo .tk-action-icon,.twikoo .tk-submit-action-icon,.twikoo .tk-time,.twikoo .tk-comments-no,.twikoo .tk-comments-count{color:var(--twikoo-body-text-color)}.twikoo .el-input__inner,.twikoo .el-textarea__inner,.twikoo .tk-preview-container,.twikoo .tk-content,.twikoo .tk-nick,.twikoo .tk-send{color:var(--twikoo-body-text-color-main)}.twikoo .el-button{color:var(--twikoo-body-text-color)!important}.twikoo .el-input__count{color:var(--twikoo-body-text-color)!important}.OwO .OwO-body{background-color:var(--body-background)!important;color:var(--body-text-color)!important}</style><script>twikoo.init({envId:"https://zwei5702-twikoo.hf.space",el:"#tcomment"})</script><section class=totalcount>发表了9篇文章 ·
总计7.98k字</section><script>Array.from(document.getElementsByClassName("language-mermaid")).forEach(e=>{e.parentElement.outerHTML=`<div class="mermaid">${e.innerText}</div>`})</script><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://fastly.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://fastly.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://fastly.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>