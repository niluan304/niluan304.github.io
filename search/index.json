[{"content":" æºä»£ç /æ•°æ®é›†å·²ä¸Šä¼ åˆ°ï¼šGitHub - follow gee to learn go\nGoFrame çš„ ReqResFunc ç±»å‹ åœ¨ day7.5 å¼€ç¯‡çš„æ—¶å€™ï¼Œç¬”è€…æåˆ° GoFrame æ”¯æŒç¬¬äºŒç§è·¯ç”±æ³¨å†Œæ–¹æ³•ï¼Œè¿™é‡Œç¬”è€…ç§°ä¹‹ä¸º ReqResFunc ç±»å‹ï¼ˆä¸‹æ–‡åŒï¼‰ï¼š\n// å†™æ³•äºŒ func (ctx context.Context, req *{Prefix}Req) (res *{Prefix}Res, err error){ // ä¸šåŠ¡ä»£ç é€»è¾‘ } ä½†æ˜¯ day9 å®ç°çš„å‡½æ•°ç­¾åï¼š\nfunc (c *user) Get(ctx context.Context, bind func(point any) (err error)) (data any, err error) å¯¹æ¯”å¯ä»¥å‘ç°ï¼Œå’Œ ReqResFunc ç±»å‹æœ‰æ˜æ˜¾ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ GoFrame çš„æºç é‡Œä¸€æ¢ç©¶ç«Ÿã€‚\nä» GoFrame çš„ æ–‡æ¡£ã€Œè·¯ç”±æ³¨å†Œ-å‡½æ•°æ³¨å†Œã€ä¸­ï¼Œå¯ä»¥æ‰¾åˆ° å…¥å£å‡½æ•°ï¼š\n// https://github.com/gogf/gf/blob/313d9d138f96b0ed460d47684298a7fb26d3fd75/net/ghttp/ghttp_server_service_handler.go#L21-L39 // BindHandler registers a handler function to server with a given pattern. // // Note that the parameter `handler` can be type of: // 1. func(*ghttp.Request) // 2. func(context.Context, BizRequest)(BizResponse, error) func (s *Server) BindHandler(pattern string, handler interface{}) { var ctx = context.TODO() funcInfo, err := s.checkAndCreateFuncInfo(handler, \u0026#34;\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;\u0026#34;) if err != nil { s.Logger().Fatalf(ctx, `%+v`, err) } s.doBindHandler(ctx, doBindHandlerInput{ Prefix: \u0026#34;\u0026#34;, Pattern: pattern, FuncInfo: funcInfo, Middleware: nil, Source: \u0026#34;\u0026#34;, }) } åœ¨æºç é‡Œï¼Œå¯ä»¥å‘ç°å…³é”®ä»£ç åœ¨ checkAndCreateFuncInfo æ–¹æ³•ï¼Œç»§ç»­å‰è¡Œï¼Œå°±èƒ½å¤Ÿå‘ç°ç«¯å€ªï¼š\n// https://github.com/gogf/gf/blob/313d9d138f96b0ed460d47684298a7fb26d3fd75/net/ghttp/ghttp_server_service_handler.go#L148 func (s *Server) checkAndCreateFuncInfo(f interface{}, pkgPath, structName,methodName string,) (funcInfo handlerFuncInfo, err error) { funcInfo = handlerFuncInfo{ // æ ¹æ®ä¼ å…¥çš„ fï¼Œåˆå§‹åŒ–è¿”å›å€¼ Type: reflect.TypeOf(f), Value: reflect.ValueOf(f), } } GoFrame é€šè¿‡åå°„ reflectï¼Œè·å–äº†ä¼ å…¥çš„å‡½æ•°çš„å‚æ•°ä¿¡æ¯ï¼Œå¹¶åšäº†ç›¸åº”çš„æ ¡éªŒï¼Œå…³é”®ä»£ç æœ‰ 5 è¡Œï¼š\n// æ ¡éªŒè¯·æ±‚å’Œè¿”å›çš„å‚æ•°æ•°é‡ if reflectType.NumIn() != 2 || reflectType.NumOut() != 2 // ç¬¬ä¸€ä¸ªè¯·æ±‚å‚æ•°å¿…é¡»ä¸º context.Context ç±»å‹ if !reflectType.In(0).Implements(reflect.TypeOf((*context.Context)(nil)).Elem()) // ç¬¬äºŒä¸ªè¿”å›å‚æ•°å¿…é¡»ä¸º error ç±»å‹ if !reflectType.Out(1).Implements(reflect.TypeOf((*error)(nil)).Elem()) // ç¬¬äºŒä¸ªè¯·æ±‚å‚æ•°å¿…é¡»ä¸ºä»¥ `Req` ç»“å°¾ if !strings.HasSuffix(reflectType.In(1).String(), `Req`) // ç¬¬ä¸€ä¸ªè¿”å›å‚æ•°å¿…é¡»ä¸ºä»¥ `Res` ç»“å°¾ if !strings.HasSuffix(reflectType.Out(0).String(), `Res`) é€šè¿‡è¿™äº›æ ¡éªŒï¼ŒGoFrame å°±å®ç°äº†è§„èŒƒè·¯ç”±å‡½æ•°å¿…é¡»æ˜¯ ResReqFunc ç±»å‹çš„çº¦æŸã€‚æ ¡éªŒè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€äº›ç»†èŠ‚ï¼š\nctx å’Œ error æ˜¯æ¥å£ç±»å‹ï¼Œåªèƒ½è°ƒç”¨ func (Type) Implements(u Type) bool ç¡®è®¤æ˜¯å¦å®ç°äº†å¯¹åº”çš„æ¥å£ï¼Œ(*error)(nil) å’Œ (*context.Context)(nil) åˆ™æ˜¯å£°æ˜äº†å¯¹åº”æ¥å£çš„ç©ºå€¼ nilã€‚ req å’Œ res çš„åˆå§‹ç±»å‹æ˜¯ç»“æ„ä½“ï¼Œå¯ä»¥ç›´æ¥è·å–ç»“æ„ä½“çš„ã€‚ å®ç° ReqResFunc ç±»å‹çš„çº¦æŸ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»¿ç…§ GoFrameï¼Œå®ç° ResReqFunc ç±»å‹çš„çº¦æŸã€‚é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªç»“æ„ä½“ï¼Œç”¨äºä¿å­˜åå°„è§£æå‡ºæ¥çš„å€¼ï¼š\ntype ReqResFunc struct { fn reflect.Value // å‡½æ•°è°ƒç”¨å…¥å£ ctx reflect.Type // ç¬¬ä¸€ä¸ªè¯·æ±‚å‚æ•°ï¼šcontext.Context req reflect.Type // ç¬¬äºŒä¸ªè¯·æ±‚å‚æ•°ï¼šXXXReq res reflect.Type // ç¬¬ä¸€ä¸ªè¿”å›å‚æ•°ï¼šXXXRes err reflect.Type // ç¬¬äºŒä¸ªè¿”å›å‚æ•°ï¼šerror } å…·ä½“çš„è§£æä»£ç ï¼Œå¯ä»¥å…¨éƒ¨ä»¿ç…§ GoFrame çš„æµç¨‹ï¼Œè·å–å…¥å‚ reqRes çš„åå°„å¯¹è±¡ï¼Œç„¶åé€ä¸ªæ ¡éªŒï¼Œæœ€åå†æ„é€  ReqResFuncã€‚\né‚£ä¹ˆè¿˜å‰©æœ€åä¸€ä¸ªé—®é¢˜ï¼Œ ReqResFunc è¦æ³¨å†Œåˆ° ginæ¡†æ¶é‡Œå‘¢ï¼Ÿè¿™é‡Œå’Œ day9 é‡åˆ°çš„æƒ…å†µä¸€æ ·ï¼Œæƒ³è®©ä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£ï¼Œèƒ½å¤Ÿä¸€èµ·å·¥ä½œï¼Œå°±éœ€è¦ä¸€ä¸ªä¸­é—´å‡½æ•°ï¼š\nfunc ReqResHandle(reqResFunc any) gin.HandlerFunc { f := NewReqResFunc(reqResFunc) return func(c *gin.Context) { req := reflect.New(f.req).Interface() // ä½¿ç”¨ reflect.New åˆå§‹åŒ–å˜é‡ if err := c.ShouldBindJSON(req); err != nil { c.JSON(http.StatusOK, Response{Code: 400, Msg: err.Error(), Data: nil}) return } result := f.fn.Call([]reflect.Value{reflect.ValueOf(c), reflect.ValueOf(req).Elem()}) if err := result[1]; !err.IsNil() { c.JSON(http.StatusOK, Response{Code: 400, Msg: err.Interface().(error).Error(), Data: nil}) } c.JSON(http.StatusOK, result[0].Interface()) } } è€Œ GoFrame ä¹Ÿæ˜¯è¿™æ ·è½¬åŒ–çš„ï¼Œç›¸å…³æºç ï¼š func createRouterFunc(funcInfo handlerFuncInfo) func(r *Request)\néªŒè¯ ReqResFunc ç±»å‹ å¢åŠ äº†ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œé‚£å¿…ç„¶æ˜¯éœ€è¦æµ‹è¯•çš„ï¼Œè¿™é‡Œå¯ä»¥æ–°å»º Upsert æ¥å£ï¼ˆå¦‚æœä¸å­˜åœ¨å°±æ–°å¢ï¼Œå­˜åœ¨å°±æ›´æ–°ï¼‰ç”¨äºæµ‹è¯•ï¼š\nfunc (c *user) Upsert(ctx context.Context, req *UserUpsertReq) (res *UserUpsertRes, err error) { // å°è¯•æ›´æ–°æ•°æ® update, err := service.User.Update(ctx, \u0026amp;service.UserUpdateReq{Name: req.Name, Age: req.Age, Job: req.Job}) if err != nil { return nil, err } if update != nil { return \u0026amp;UserUpsertRes{Name: update.Name, Age: update.Age, Job: update.Job}, nil } // æ•°æ®ä¸å­˜åœ¨åˆ™æ–°å¢ // TODO æ›´æ–°æ•°æ®ä¸å­˜åœ¨æ—¶ï¼Œåº”å½“è¿”å›è‡ªå®šä¹‰ç±»å‹çš„é”™è¯¯ï¼Œè€Œä¸æ˜¯é€šè¿‡ nil åˆ¤æ–­ _, err = service.User.Add(ctx, \u0026amp;service.UserAddReq{Name: req.Name, Age: req.Age, Job: req.Job}) if err != nil { return nil, err } return nil, nil } ä»£ç å®ç°å¾ˆç®€å•ï¼Œå…ˆè°ƒç”¨ service.User.Updateï¼Œå¦‚æœ update == nil å°±è¡¨ç¤ºæ›´æ–°å¤±è´¥ï¼Œæ•°æ®åº“æœªæ‰¾åˆ°è¿™æ¡æ•°æ®ã€‚ç„¶åå†æ‰§è¡Œæ•°æ®æ’å…¥ service.User.Add çš„æ“ä½œã€‚å½“ç„¶ï¼Œä¸»æµçš„æ•°æ®åº“é‡Œéƒ½æœ‰ç±»ä¼¼çš„è¯­æ³•å®ç° Upsertï¼Œå¦‚ MySQL å’Œ Postgresã€‚\nä½†è¿™å¹¶ä¸æ˜¯é‡ç‚¹ï¼Œæˆ‘ä»¬åº”è¯¥èšç„¦äºæ–°æ¥å£ *user.Upsert æœ¬èº«ï¼Œä»–åªè°ƒç”¨ä¸¤ä¸ªå·²æœ‰çš„ä¸šåŠ¡æ–¹æ³•å°±å®Œæˆè‡ªèº«çš„å·¥ä½œï¼Œè¿™è§£å†³äº† day8 æåˆ°çš„ã€Œä»£ç éš¾ä»¥å¤ç”¨ã€çš„é—®é¢˜ï¼š\nå‡å¦‚éšç€é¡¹ç›®çš„è¿›å±•ï¼Œå¯¼è‡´ Add éƒ¨åˆ†ä¸šåŠ¡ä»£ç å’Œ Get çš„å®Œå…¨ä¸€è‡´ï¼Œç”šè‡³æœ€å¥½çš„è§£å†³åŠæ³•æ˜¯ç›´æ¥è°ƒç”¨ Get æ–¹å¼ï¼Œä½†è¿™æ²¡åŠæ³•çœŸçš„å»è°ƒç”¨ Get æ–¹å¼ï¼Œå› ä¸º Add æ¥æ”¶åˆ°çš„ *gin.Context ä¸ Get æ–¹æ³•éœ€è¦çš„ *gin.Context æ˜¯æœ‰å·®åˆ«çš„ã€‚\næµ‹è¯•æ¥å£ï¼š\nfunc client() { time.Sleep(time.Second) // ç­‰å¾…è·¯ç”±æ³¨å†Œ reqs := []func(host string) (*http.Response, error){ func(host string) (*http.Response, error) { return http.Get(host + \u0026#34;/user?name=Carol\u0026#34;) }, func(host string) (*http.Response, error) { return http.Get(host + \u0026#34;/user?name=Bob\u0026#34;) }, func(host string) (*http.Response, error) { return http.Post(host+\u0026#34;/user\u0026#34;, \u0026#34;application/json\u0026#34;, bytes.NewBufferString(`{\u0026#34;name\u0026#34;:\u0026#34;Carol\u0026#34;,\u0026#34;age\u0026#34;:44,\u0026#34;job\u0026#34;:\u0026#34;worker\u0026#34;}`)) }, func(host string) (*http.Response, error) { return http.Get(host + \u0026#34;/user?name=Carol\u0026#34;) }, // æµ‹è¯• upsert æ¥å£ func(host string) (*http.Response, error) { return http.Post(host+\u0026#34;/user/upsert\u0026#34;, \u0026#34;application/json\u0026#34;, bytes.NewBufferString(`{\u0026#34;name\u0026#34;:\u0026#34;Dave\u0026#34;,\u0026#34;age\u0026#34;:32,\u0026#34;job\u0026#34;:\u0026#34;nurse\u0026#34;}`)) }, func(host string) (*http.Response, error) { return http.Post(host+\u0026#34;/user/upsert\u0026#34;, \u0026#34;application/json\u0026#34;, bytes.NewBufferString(`{\u0026#34;name\u0026#34;:\u0026#34;Dave\u0026#34;,\u0026#34;age\u0026#34;:35,\u0026#34;job\u0026#34;:\u0026#34;doctor\u0026#34;}`)) }, func(host string) (*http.Response, error) { return http.Get(host + \u0026#34;/user?name=Dave\u0026#34;) }, } for _, req := range reqs { resp, err := req(\u0026#34;http://localhost:8080\u0026#34;) if err != nil { fmt.Println(\u0026#34;req err\u0026#34;, err) } data, err := io.ReadAll(resp.Body) if err != nil { fmt.Println(\u0026#34;read resp.Body err\u0026#34;, err) } fmt.Println(string(data)) } // Output: // // {\u0026#34;code\u0026#34;:200,\u0026#34;msg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:null} // {\u0026#34;code\u0026#34;:200,\u0026#34;msg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:{\u0026#34;name\u0026#34;:\u0026#34;Bob\u0026#34;,\u0026#34;age\u0026#34;:30,\u0026#34;job\u0026#34;:\u0026#34;driver\u0026#34;}} // {\u0026#34;code\u0026#34;:200,\u0026#34;msg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:null} // {\u0026#34;code\u0026#34;:200,\u0026#34;msg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:{\u0026#34;name\u0026#34;:\u0026#34;Carol\u0026#34;,\u0026#34;age\u0026#34;:44,\u0026#34;job\u0026#34;:\u0026#34;worker\u0026#34;}} // {\u0026#34;code\u0026#34;:200,\u0026#34;msg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:null} // {\u0026#34;code\u0026#34;:200,\u0026#34;msg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:{\u0026#34;name\u0026#34;:\u0026#34;Dave\u0026#34;,\u0026#34;age\u0026#34;:32,\u0026#34;job\u0026#34;:\u0026#34;nurse\u0026#34;}} // {\u0026#34;code\u0026#34;:200,\u0026#34;msg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:{\u0026#34;name\u0026#34;:\u0026#34;Dave\u0026#34;,\u0026#34;age\u0026#34;:35,\u0026#34;job\u0026#34;:\u0026#34;doctor\u0026#34;}} } ä»æ–°å¢çš„è¯·æ±‚çš„ç»“æœæ¥çœ‹ï¼Œå®ç°äº†å…ˆæ’å…¥äº† Dave ä¸º nurse çš„æ•°æ®ï¼Œåé¢å°† Dave ä¿®æ”¹äº† doctorï¼Œç¬¦åˆé¢„æœŸï¼Œè¯´æ˜ ReqResFunc ç±»å‹æµ‹è¯•é€šè¿‡ã€‚\né€šè¿‡å¯¹è±¡æ³¨å†Œè·¯ç”± äº‹å®ä¸Šï¼ŒGoFrame è¿˜æœ‰ç¬¬ä¸‰ç§è·¯ç”±æ³¨å†Œæ–¹æ³•ï¼šå¯¹è±¡æ³¨å†Œï¼Œå‘ *(ghttp.RouterGroup).Bind ä¼ å…¥ä¸€ä¸ªç»“æ„ä½“å˜é‡ï¼Œç„¶å GoFrame ä¼šå°è¯•æ³¨å†Œè¿™ä¸ªç»“æ„ä½“ä¸Šçš„æ‰€æœ‰ ReqResFunc ç±»å‹çš„æ–¹æ³•ã€‚è¿™ä¹Ÿæ˜¯é€šè¿‡åå°„å®ç°çš„ï¼Œæ ¸å¿ƒä»£ç ä¹Ÿå¾ˆç®€çŸ­ï¼š\nfunc ObjectHandler(object any) (handles []gin.HandlerFunc) { v := reflect.ValueOf(object) // å¦‚æœæ˜¯ç»“æ„ä½“, é‚£ä¹ˆè·å–è¿™ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆ, ä»è€Œéå†åˆ°ä»–çš„æ‰€æœ‰æ–¹æ³• if v.Kind() == reflect.Struct { newValue := reflect.New(v.Type()) newValue.Elem().Set(v) v = newValue } if v.Kind() != reflect.Pointer { panic(\u0026#34;v.Kind() must be reflect.Pointer\u0026#34;) } t := v.Type() for i := 0; i \u0026lt; t.NumMethod(); i++ { fn := v.MethodByName(t.Method(i).Name) // æ‰€æœ‰æ–¹æ³•éƒ½å¿…é¡»ä¸º ReqResFunc ç±»å‹ handles = append(handles, ReqResHandle(fn.Interface())) } return handles } é€šè¿‡å¯¹è±¡æ³¨å†Œè·¯ç”±æœ‰ä¸ªç¼ºç‚¹ï¼Œéš¾ä»¥ä¸º HandlerFunc ç»‘å®š path å’Œ methodã€‚GoFrame çš„è§£å†³æ–¹å¼æ˜¯åœ¨ Reqï¼ˆç¬¬äºŒä¸ªè¯·æ±‚å‚æ•°ï¼‰é‡Œå†™ go tagï¼Œæœ‰å…´è¶£çš„è¯»è€…ï¼Œå¯ä»¥å¯Ÿçœ‹ã€Œæ–‡æ¡£ï¼šè§„èŒƒå‚æ•°ç»“æ„ã€æˆ–è‡ªå·±å®ç°ï¼ˆGoFrame æºç å‚è€ƒã€‚\n","date":"2023-12-22T15:43:59+08:00","permalink":"https://niluan304.github.io/p/gee-web-day10-%E9%80%9A%E8%BF%87%E5%8F%8D%E5%B0%84%E6%9E%84%E9%80%A0%E8%A7%84%E8%8C%83%E8%B7%AF%E7%94%B1/","title":"gee-web-day10 é€šè¿‡åå°„æ„é€ è§„èŒƒè·¯ç”±"},{"content":" æºä»£ç /æ•°æ®é›†å·²ä¸Šä¼ åˆ°ï¼šGitHub - follow gee to learn go\nç»è¿‡åˆ†å±‚å¤„ç†åï¼Œé¡¹ç›®å¸ƒå±€æœ‰äº†å¾ˆå¤§æ”¹å–„ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨é—®é¢˜ã€‚\ncontroller å±‚çš„é”™è¯¯å¤„ç†ä»£ç ç‰¹åˆ«ç¹çï¼Œæœ‰å¤ªå¤šçš„ï¼šctx.JSON(http.StatusOK, Response{400, err.Error(), nil}) controller å±‚åªæ”¯æŒ gin æ¡†æ¶ï¼Œæ›´ä¸æ”¯æŒå…¶ä»–åè®® è®©è°ƒç”¨è€…å¸®å¿™ååºåˆ—åŒ– è§‚å¯Ÿ controller å±‚å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šcontroller çš„éœ€æ±‚å…¶å®å¾ˆç®€å•ï¼šååºåˆ—åŒ–ä¸º service å±‚æ‰€éœ€è¦ go ç±»å‹ï¼Œå¹¶åœ¨ err != nil æ—¶åšæ§åˆ¶çš„æµè½¬ã€‚\né‚£ä¹ˆè¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿè¿™å…¶å®å¹¶ä¸éš¾ã€‚\nä¸çŸ¥é“æ˜¯å¦æœ‰è¯»è€…ä¼šå¥½å¥‡ Get æ–¹æ³•é‡Œçš„æœç´¢å‡½æ•°ï¼š\n// ./day8/internal/service/user.go i := slices.IndexFunc(database, func(row Row) bool { return row.Name == req.Name }) åªéœ€è¦å¾€ slices.IndexFunc ä¼ å…¥äº†ä¸€ä¸ªé—­åŒ…ï¼Œå°±å¯ä»¥ç­‰å¾…å‡½æ•°è¿”å›æ‰€åœ¨å€¼çš„ç´¢å¼•ï¼Œslices.IndexFuncçš„å®ç°ï¼Œä¹ŸåŒæ ·ç®€å•ï¼š\n// std: slices/slices.go // IndexFunc returns the first index i satisfying f(s[i]), // or -1 if none do. func IndexFunc[S ~[]E, E any](s S, f func(E) bool) int { for i := range s { if f(s[i]) { return i } } return -1 } ä½†è®©æˆ‘ä»¬æ¢ä¸ªè§’åº¦æ€è€ƒï¼Œå¯¹äº slices.IndexFunc æ¥è¯´ï¼Œå®ƒå¹¶ä¸å…³å¿ƒ s é‡Œçš„å…ƒç´ ï¼Œåªå…³å¿ƒ f(s[i]) çš„ç»“æœï¼Œå› æ­¤åªéœ€è¦è°ƒç”¨ä¼ å…¥çš„é—­åŒ…ï¼Œå°±å®Œæˆäº†ä»»åŠ¡ã€‚åŒæ ·åœ°ï¼Œå¯¹äº controller å±‚æ¥è¯´ï¼Œåªå…³å¿ƒååºåˆ—åŒ– var req service.UserGetReqã€‚é‚£ä¹ˆèƒ½å¦ä»¿ç…§ slices.IndexFunc è®©å¤–éƒ¨ä¼ å…¥ä¸€ä¸ªé—­åŒ…ï¼Œè®©é—­åŒ…å¸® controller å±‚ååºåˆ—åŒ– reqå‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œåªéœ€è¦ä¿®æ”¹ controller çš„å…¥å‚ä¸ºï¼š\nfunc (c *user) Get( ctx context.Context, // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šctx bind func(point any) (err error), // ç¬¬äºŒä¸ªå‚æ•°ï¼šç”¨äºååºåˆ—åŒ–çš„é—­åŒ… ) ( data any, // è¿”å›çš„æ•°æ® err error, // é”™è¯¯å¤„ç† ){ var req service.UserGetReq err = bind(\u0026amp;req) // é€šè¿‡é—­åŒ…ååºåˆ—åŒ– req if err != nil { return nil, err } res, err := service.User.Get(ctx, req) if err != nil { return nil, err } return res, nil } ç»è¿‡æ”¹åŠ¨çš„ controller å’Œ webæ¡†æ¶å½»åº•è§£è€¦äº†ï¼Œå®Œå…¨çœ‹ä¸åˆ° gin æ¡†æ¶çš„ä»£ç ï¼Œæ¯•ç«Ÿååºåˆ—åŒ–çš„å·¥ä½œä¹Ÿå¹¶ä¸æ˜¯ controller çš„ä»»åŠ¡ï¼Œé”™è¯¯å¤„ç†å’Œæ•°æ®è¿”å›ä¹Ÿå˜å¾—éå¸¸ç®€å•ï¼Œåªéœ€è¦æŠ›ç»™ä¸Šå±‚å¤„ç†ï¼ˆè¦ä¹ˆ return nil, errï¼Œè¦ä¹ˆ return res, nilï¼‰ï¼Œè§£è€¦ä¹‹åä¹Ÿä¸º controller å±‚å…¼å®¹å¤šç§åè®®å¸¦æ¥äº†å¯èƒ½ã€‚\nä¸è¿‡ä½†ä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼šè¿™æ ·çš„å‡½æ•°ï¼Œè¯¥å¦‚ä½•æ³¨å†Œåˆ° ginæ¡†æ¶é‡Œå‘¢ï¼Ÿ\nç»Ÿä¸€é”™è¯¯å¤„ç†å’Œæ•°æ®è¿”å› é˜è¿°è¿™éƒ¨åˆ†å†…å®¹ä¹‹å‰ï¼Œç¬”è€…æƒ³ç®€å•çš„ä»‹ç»ä¸€ä¸‹ã€Œè®¾è®¡æ¨¡å¼ã€é‡Œçš„ã€Œé€‚é…å™¨æ¨¡å¼ã€1ï¼š\nç®€å•æ¥è®²ï¼Œå°±æ˜¯é€šè¿‡æ¥å£è½¬æ¢ï¼Œè®©ä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£ï¼Œèƒ½å¤Ÿä¸€èµ·å·¥ä½œï¼Œç°å®ä¸­çš„ç»å…¸ä¾‹å­ï¼š å’Œä¸Šé¢çš„å›¾ç‰‡ç±»ä¼¼ï¼Œä¿®æ”¹åçš„å‡½æ•°ç±»å‹å·²ç»å’Œæ¡†æ¶è¦æ±‚çš„ gin.HandlerFunc æˆªç„¶ä¸åŒï¼Œä½†å€Ÿé‰´é€‚é…å™¨æ¨¡å¼çš„æ€æƒ³ï¼Œé€šè¿‡ä¸­é—´å‡½æ•°è½¬åŒ–ï¼Œå°±å¯ä»¥äº†ï¼š\n// ./handle/handle.go // è®¾ç½®ä¸ºç±»å‹ï¼Œç”¨äºä¼˜åŒ–å‚æ•°æ˜¾ç¤º type BinderFunc = func( ctx context.Context, // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šctx bind func(point any) (err error), // ç¬¬äºŒä¸ªå‚æ•°ï¼šç”¨äºååºåˆ—åŒ–çš„é—­åŒ… ) ( data any, // è¿”å›çš„æ•°æ® err error, // é”™è¯¯å¤„ç† ) func Handle(binder BinderFunc) gin.HandlerFunc { return func(c *gin.Context) { data, err := binder(c, func(point any) (err error) { // å®ç°ååºåˆ—åŒ– return c.ShouldBind(point) }) if err != nil { c.JSON(http.StatusOK, Response{Code: 400, Msg: err.Error(), Data: nil}) return } c.JSON(http.StatusOK, Response{200, \u0026#34;\u0026#34;, data}) } } æ–°çš„å‡½æ•°ä½œä¸ºã€Œé€‚é…å™¨ã€ï¼Œä¹Ÿä¼šè¢«å…¶ä»–è·¯ç”±è°ƒç”¨ï¼Œä¹Ÿä¸æ˜¯ä¸šåŠ¡ç›¸å…³çš„å†…å®¹ï¼Œä¸é€‚åˆæ”¾åˆ° internal åŒ…ï¼Œåº”å½“æ”¾åˆ°æ–°çš„åŒ…ï¼ˆæ–‡ä»¶å¤¹ï¼‰é‡Œï¼Œç¬”è€…å°†ä¹‹ä¿å­˜è‡³ /handle/handle.goã€‚\nç›¸åº”åœ°ï¼Œè·¯ç”±æ³¨å†Œä¹Ÿæœ‰äº›å˜åŒ–ï¼š\nfunc main() { r := gin.Default() { user := r.Group(\u0026#34;/user\u0026#34;) user.GET(\u0026#34;/\u0026#34;, handle.Handle(controller.User.Get)) user.POST(\u0026#34;/\u0026#34;, handle.Handle(controller.User.Add)) } r.Run() // listen and serve on 0.0.0.0:8080 (for windows \u0026#34;localhost:8080\u0026#34;) } å¯¹æ¯” day8 çš„æ³¨å†Œæ¨¡å¼ï¼š\nuser.GET(\u0026#34;/\u0026#34;, controller.User.Get) // å‡½æ•°ç­¾åï¼šfunc (c *user) Get(ctx *gin.Context) user.POST(\u0026#34;/\u0026#34;, controller.User.Add) // å‡½æ•°ç­¾åï¼šfunc (c *user) Add(ctx *gin.Context) è™½ç„¶æ³¨å†Œè·¯ç”±æ—¶ï¼Œå¿…é¡»å¾—å€Ÿç”¨ handle.Handle æ‰èƒ½è½¬åŒ–ä¸º gin.HandlerFuncï¼Œä½†æ˜¯å¯ä»¥ä¸ç”¨åœ¨ controllerå±‚é‡Œå†™ c.JSON(http.StatusOK, Response{Code: 400, Msg: err.Error(), Data: nil}) å’Œ c.JSON(http.StatusOK, Response{200, \u0026quot;\u0026quot;, data}) äº†ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†é”™è¯¯å¤„ç†å’Œæ•°æ®è¿”å›çš„ç»Ÿä¸€ã€‚\nå°ç»“ æœ¬ç« èŠ‚ä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼š\ncontroller å±‚é€šè¿‡ä¼ å…¥ binder é—­åŒ…ï¼Œè°ƒç”¨é—­åŒ…å®ç°ååºåˆ—åŒ–å‡º service å±‚æ‰€éœ€æ•°æ®ï¼Œä¹Ÿå®Œæˆäº† controller ä¸æ¡†æ¶çš„è§£è€¦ï¼Œæ—¥åå¯ä»¥å…¼å®¹å…¶ä»–æ¡†æ¶ï¼ˆå¦‚ echoï¼‰å’Œå…¶ä»–åè®®ï¼ˆå¦‚ rpcï¼‰ã€‚ å€Ÿé‰´é€‚é…å™¨æ¨¡å¼ï¼Œå°† binderFunc å‡½æ•°è½¬åŒ–ä¸ºæ¡†æ¶æ‰€éœ€è¦çš„ç±»å‹ï¼Œå¹¶å®ç°é”™è¯¯å¤„ç†å’Œæ•°æ®è¿”å›çš„ç»Ÿä¸€ã€‚ è¿è¡Œç»“æœä¹Ÿæ²¡æœ‰å˜åŒ–ï¼š\nfunc client() { time.Sleep(time.Second) // ç­‰å¾…è·¯ç”±æ³¨å†Œ reqs := []func(host string) (*http.Response, error){ func(host string) (*http.Response, error) { return http.Get(host + \u0026#34;/user?name=Carol\u0026#34;) }, func(host string) (*http.Response, error) { return http.Get(host + \u0026#34;/user?name=Bob\u0026#34;) }, func(host string) (*http.Response, error) { return http.Post(host+\u0026#34;/user\u0026#34;, \u0026#34;application/json\u0026#34;, bytes.NewBufferString(`{\u0026#34;name\u0026#34;:\u0026#34;Carol\u0026#34;,\u0026#34;age\u0026#34;:44,\u0026#34;job\u0026#34;:\u0026#34;worker\u0026#34;}`)) }, func(host string) (*http.Response, error) { return http.Get(host + \u0026#34;/user?name=Carol\u0026#34;) }, } for _, req := range reqs { resp, err := req(\u0026#34;http://localhost:8080\u0026#34;) if err != nil { fmt.Println(\u0026#34;req err\u0026#34;, err) } data, err := io.ReadAll(resp.Body) if err != nil { fmt.Println(\u0026#34;read resp.Body err\u0026#34;, err) } fmt.Println(string(data)) } // Output: // // {\u0026#34;code\u0026#34;:200,\u0026#34;msg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:null} // {\u0026#34;code\u0026#34;:200,\u0026#34;msg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:{\u0026#34;name\u0026#34;:\u0026#34;Bob\u0026#34;,\u0026#34;age\u0026#34;:30,\u0026#34;job\u0026#34;:\u0026#34;driver\u0026#34;}} // {\u0026#34;code\u0026#34;:200,\u0026#34;msg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:null} // {\u0026#34;code\u0026#34;:200,\u0026#34;msg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:{\u0026#34;name\u0026#34;:\u0026#34;Carol\u0026#34;,\u0026#34;age\u0026#34;:44,\u0026#34;job\u0026#34;:\u0026#34;worker\u0026#34;}} } é€‚é…å™¨æ¨¡å¼\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2023-12-21T18:15:11+08:00","permalink":"https://niluan304.github.io/p/gee-web-day9-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E8%A7%A3%E8%80%A6/","title":"gee-web-day9 ååºåˆ—åŒ–ä¸è§£è€¦"},{"content":" æºä»£ç /æ•°æ®é›†å·²ä¸Šä¼ åˆ°ï¼šGitHub - follow gee to learn go\nä»€ä¹ˆæ˜¯è¯·æ±‚åˆ†å±‚æµè½¬ åœ¨é˜è¿°ä¸ºä»€ä¹ˆéœ€è¦åˆ†å±‚è®¾è®¡ä¹‹å‰ï¼Œç¬”è€…æƒ³å…ˆä»‹ç»ä¸€ä¸‹åˆ†å±‚æµè½¬1ï¼š\nåˆ†å±‚ä¹‹åï¼Œå¯ä»¥è®©æ¯ä¸€ä¸ªå‡½æ•°åªè´Ÿè´£ä¸€ä»¶äº‹ï¼Œè¿™ç±»ä¼¼äºè®¾è®¡æ¨¡å¼é‡Œå•ä¸€èŒè´£çš„æ€æƒ³ï¼Œå¯ä»¥æé«˜é¡¹ç›®çš„å¯ç»´æŠ¤æ€§ï¼Œä¸æ¥å£çš„å¯å¤ç”¨æ€§ã€‚\nä»£ç çº ç¼ çš„å›°å¢ƒ è¿™é‡Œæœ‰ä¸€ä»½ç®€å•çš„ CURD ä»£ç ï¼Œç›®å‰åªæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼ŒAdd, Getï¼š\ntype Response struct { Code int // ä¸šåŠ¡ä»£ç ï¼Œ200 è¡¨ç¤º OKï¼Œå…¶ä»–è¡¨ç¤ºé”™è¯¯ Msg string // é”™è¯¯æ¶ˆæ¯ database any // è¿”å›çš„æ•°æ® } type Row struct { Name string Age int Job string } // database åªæ˜¯ä¸€ä¸ªåˆ‡ç‰‡ []Rowï¼Œç”¨äºå……å½“æ•°æ®åº“ var database = []Row{ {\u0026#34;Alice\u0026#34;, 32, \u0026#34;teacher\u0026#34;}, {\u0026#34;Bob\u0026#34;, 30, \u0026#34;driver\u0026#34;} } var User = \u0026amp;user{} type user struct{} func (c *user) Add(ctx *gin.Context) { var req Row err := ctx.ShouldBind(\u0026amp;req) // è¯·æ±‚æ•°æ®çš„ååºåˆ—åŒ– if err != nil { ctx.JSON(http.StatusOK, Response{400, err.Error(), nil}) return } // æ’å…¥æ•°æ®ï¼Œdatabase åªæ˜¯ä¸€ä¸ªåˆ‡ç‰‡ []Rowï¼Œç”¨äºå……å½“æ•°æ®åº“ database = append(database, req) // å¡«å†™å“åº”å†…å®¹ ctx.JSON(http.StatusOK, Response{200, \u0026#34;\u0026#34;, nil}) return } func (c *user) Get(ctx *gin.Context) { var req Row err := ctx.ShouldBind(\u0026amp;req) if err != nil { ctx.JSON(http.StatusOK, Response{400, err.Error(), nil}) return } // æŸ¥è¯¢æ•°æ®ï¼Œdatabase åªæ˜¯ä¸€ä¸ªåˆ‡ç‰‡ []Rowï¼Œç”¨äºå……å½“æ•°æ®åº“ i := slices.IndexFunc(database, func(row Row) bool { return row.Name == req.Name }) if i != -1 { // å¡«å†™å“åº”å†…å®¹ ctx.JSON(http.StatusOK, Response{200, \u0026#34;\u0026#34;, database[i]}) } return } çœ‹èµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å‡å¦‚éšç€é¡¹ç›®çš„è¿›å±•ï¼Œå¯¼è‡´ Add éƒ¨åˆ†ä¸šåŠ¡ä»£ç å’Œ Get çš„å®Œå…¨ä¸€è‡´ï¼Œç”šè‡³æœ€å¥½çš„è§£å†³åŠæ³•æ˜¯ç›´æ¥è°ƒç”¨ Get æ–¹å¼ï¼Œä½†è¿™æ²¡åŠæ³•çœŸçš„å»è°ƒç”¨ Get æ–¹å¼ï¼Œå› ä¸º Add æ¥æ”¶åˆ°çš„ *gin.Context ä¸ Get æ–¹æ³•éœ€è¦çš„ *gin.Context æ˜¯æœ‰å·®åˆ«çš„ã€‚\nè¿™æ—¶å€™å°±å¯ä»¥è¿›è¡Œåˆ†å±‚è®¾è®¡ï¼Œç°åœ¨æ¯”è¾ƒæµè¡Œçš„çº¯åç«¯ API æ¨¡å—ä¸€èˆ¬é‡‡ç”¨ä¸‹è¿°åˆ’åˆ†æ–¹æ³•2\nControllerï¼Œä¸ä¸Šè¿°ç±»ä¼¼ï¼ŒæœåŠ¡å…¥å£ï¼Œè´Ÿè´£å¤„ç†è·¯ç”±ï¼Œå‚æ•°æ ¡éªŒï¼Œè¯·æ±‚è½¬å‘ã€‚ Logic/Serviceï¼Œé€»è¾‘ï¼ˆæœåŠ¡ï¼‰å±‚ï¼Œä¸€èˆ¬æ˜¯ä¸šåŠ¡é€»è¾‘çš„å…¥å£ï¼Œå¯ä»¥è®¤ä¸ºä»è¿™é‡Œå¼€å§‹ï¼Œæ‰€æœ‰çš„è¯·æ±‚å‚æ•°ä¸€å®šæ˜¯åˆæ³•çš„ã€‚ä¸šåŠ¡é€»è¾‘å’Œä¸šåŠ¡æµç¨‹ä¹Ÿéƒ½åœ¨è¿™ä¸€å±‚ä¸­ã€‚å¸¸è§çš„è®¾è®¡ä¸­ä¼šå°†è¯¥å±‚ç§°ä¸º Business Rulesã€‚ DAO/Repositoryï¼Œè¿™ä¸€å±‚ä¸»è¦è´Ÿè´£å’Œæ•°æ®ã€å­˜å‚¨æ‰“äº¤é“ã€‚å°†ä¸‹å±‚å­˜å‚¨ä»¥æ›´ç®€å•çš„å‡½æ•°ã€æ¥å£å½¢å¼æš´éœ²ç»™ Logic å±‚æ¥ä½¿ç”¨ã€‚è´Ÿè´£æ•°æ®çš„æŒä¹…åŒ–å·¥ä½œã€‚ åˆ†å±‚è®¾è®¡ å…ˆä»‹ç»ä¸‹åˆ†å±‚åçš„ç›®å½•ç»“æ„ï¼š\n. |-- go.mod |-- go.sum |-- internal | |-- controller | | `-- user.go | `-- service | |-- user.go | `-- user_model.go `-- main.go å½“ä¸šåŠ¡ä»£ç éƒ½æ”¾åˆ°äº† service å±‚æ—¶ï¼Œè¿™ä¸€å±‚çš„ä»£ç äº’ç›¸è°ƒç”¨æ˜¯ä¸ä¼šè¢« controller å±‚å½±å“çš„ï¼Œè¿™ä¹Ÿå®ç°äº† gin æ¡†æ¶ä¸ä¸šåŠ¡ä»£ç çš„è§£è€¦ã€‚\ncontroller å±‚çš„ä¸»è¦ä»£ç ï¼š\n// ./internal/controller/user.go func (c *user) Add(ctx *gin.Context) { // è¯·æ±‚æ•°æ®çš„ååºåˆ—åŒ– var req *service.UserAddReq err := ctx.ShouldBind(\u0026amp;req) if err != nil { ctx.JSON(http.StatusOK, Response{400, err.Error(), nil}) return } res, err := service.User.Add(ctx, req) if err != nil { ctx.JSON(http.StatusOK, Response{400, err.Error(), nil}) return } // å¡«å†™å“åº”å†…å®¹ ctx.JSON(http.StatusOK, Response{200, \u0026#34;\u0026#34;, res}) return } func (c *user) Get(ctx *gin.Context) { var req *service.UserGetReq err := ctx.ShouldBind(\u0026amp;req) if err != nil { ctx.JSON(http.StatusOK, Response{400, err.Error(), nil}) return } res, err := service.User.Get(ctx, req) if err != nil { ctx.JSON(http.StatusOK, Response{400, err.Error(), nil}) return } // å¡«å†™å“åº”å†…å®¹ ctx.JSON(http.StatusOK, Response{200, \u0026#34;\u0026#34;, res}) return } service å±‚çš„ä¸»è¦ä»£ç ï¼š\n// ./internal/service/user.go func (s *user) Add(ctx context.Context, req *UserAddReq) (res *UserAddRes, err error) { // æ’å…¥æ•°æ® database = append(database, Row{req.Name, req.Age, req.Job}) return } func (s *user) Get(ctx context.Context, req *UserGetReq) (res *UserGetRes, err error) { // æŸ¥è¯¢æ•°æ® i := slices.IndexFunc(database, func(row Row) bool { return row.Name == req.Name }) if i != -1 { // å¡«å†™å“åº”å†…å®¹ row := database[i] return \u0026amp;UserGetRes{Name: row.Name, Age: row.Age, Job: row.Job}, nil } return } åˆ†å±‚åçš„æ€»ä»£ç è¡Œæ•°æœ‰æ‰€å¢åŠ ï¼Œç”šè‡³ controller é”™è¯¯å¤„ç†å˜å¾—æ›´ç¹çäº†ï¼Œä½†æ˜¯æ•´ä¸ªé¡¹ç›®çš„å¸ƒå±€å˜å¾—æ›´æ¸…æ™°äº†ï¼Œä¸šåŠ¡ä»£ç ä¹Ÿä¸ä¼šå—åˆ° webæ¡†æ¶çš„å¹²æ‰°ï¼Œå¯ä»¥é›†ä¸­å¤„ç†ä¸šåŠ¡ã€‚\næ›´å¯è´µçš„æ˜¯ï¼Œservice å±‚çš„æ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œå°±å¯ä»¥çŸ¥é“æ‰€éœ€è¦çš„å‚æ•°ï¼Œä»¥åŠè¿”å›çš„å€¼ã€‚ä¸è¿‡æœ‰äº›è¯»è€…å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆ service å±‚æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯ ctx context.Contextï¼Œå³ä¾¿ä»£ç ä¸­æœªå¿…ä½¿ç”¨ï¼Œè¿™ç®—æ˜¯ go è¯­è¨€åœ¨ web å¼€å‘ä¸­çš„ç‰¹è‰²ï¼ˆä¹Ÿå¯èƒ½æ˜¯æŠ€æœ¯å€ºï¼‰ï¼Œç”¨äºå¹¶å‘æ§åˆ¶å’Œä¸Šä¸‹æ–‡ä¿¡æ¯ä¼ é€’çš„ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªè¡Œäº†è§£ä¸‹ã€‚\nå°ç»“ æœ¬ç« èŠ‚ä»‹ç»ä¸‹ã€Œåˆ†å±‚è®¾è®¡ã€ä¸ã€Œå•ä¸€èŒè´£ã€çš„è”ç³»ï¼Œå¹¶è¯´æ˜å¦‚ä½•é€šè¿‡åˆ†å±‚è®¾è®¡å°†ä¸šåŠ¡ä»£ç ä¸ webæ¡†æ¶è§£è€¦ã€‚\næ³¨æ„ï¼šåˆ†å±‚è®¾è®¡ä¹Ÿä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šæ–°å¢ä¸€ä¸ªä¸šåŠ¡æ¥å£æ—¶ï¼Œéœ€è¦æ”¹åŠ¨çš„æ–‡ä»¶ä¹Ÿä¼šå˜å¤šï¼Œä¸è¿‡è¿™å¯ä»¥é€šè¿‡è„šæœ¬ç”Ÿæˆä»£ç ç¼“è§£ã€‚ æœ€åè®©æˆ‘ä»¬æ¥çœ‹çœ‹ç¨‹åºçš„è¿è¡Œç»“æœï¼š\nfunc client() { time.Sleep(time.Second) // ç­‰å¾…è·¯ç”±æ³¨å†Œ reqs := []func(host string) (*http.Response, error){ func(host string) (*http.Response, error) { return http.Get(host + \u0026#34;/user?name=Carol\u0026#34;) }, func(host string) (*http.Response, error) { return http.Get(host + \u0026#34;/user?name=Bob\u0026#34;) }, func(host string) (*http.Response, error) { return http.Post(host+\u0026#34;/user\u0026#34;, \u0026#34;application/json\u0026#34;, bytes.NewBufferString(`{\u0026#34;name\u0026#34;:\u0026#34;Carol\u0026#34;,\u0026#34;age\u0026#34;:44,\u0026#34;job\u0026#34;:\u0026#34;worker\u0026#34;}`)) }, func(host string) (*http.Response, error) { return http.Get(host + \u0026#34;/user?name=Carol\u0026#34;) }, } for _, req := range reqs { resp, err := req(\u0026#34;http://localhost:8080\u0026#34;) if err != nil { fmt.Println(\u0026#34;req err\u0026#34;, err) } data, err := io.ReadAll(resp.Body) if err != nil { fmt.Println(\u0026#34;read resp.Body err\u0026#34;, err) } fmt.Println(string(data)) } // Output: // // {\u0026#34;code\u0026#34;:200,\u0026#34;msg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:null} // {\u0026#34;code\u0026#34;:200,\u0026#34;msg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:{\u0026#34;name\u0026#34;:\u0026#34;Bob\u0026#34;,\u0026#34;age\u0026#34;:30,\u0026#34;job\u0026#34;:\u0026#34;driver\u0026#34;}} // {\u0026#34;code\u0026#34;:200,\u0026#34;msg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:null} // {\u0026#34;code\u0026#34;:200,\u0026#34;msg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:{\u0026#34;name\u0026#34;:\u0026#34;Carol\u0026#34;,\u0026#34;age\u0026#34;:44,\u0026#34;job\u0026#34;:\u0026#34;worker\u0026#34;}} } å·¥ç¨‹ç›®å½•è®¾è®¡ğŸ”¥ - GoFrame (ZH)\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nå¤§å‹Webé¡¹ç›®åˆ†å±‚ - Goè¯­è¨€é«˜çº§ç¼–ç¨‹ï¼š\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2023-12-20T13:49:08+08:00","permalink":"https://niluan304.github.io/p/gee-web-day8-%E5%88%86%E5%B1%82%E8%AE%BE%E8%AE%A1%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7/","title":"gee-web-day8 åˆ†å±‚è®¾è®¡çš„å¿…è¦æ€§"},{"content":"è·Ÿç€è¿™ç¯‡æ•™ç¨‹ 7å¤©ç”¨Goä»é›¶å®ç°Webæ¡†æ¶Geeæ•™ç¨‹ | æå®¢å…”å…”ï¼Œç¬”è€…å®ç°äº†ä¸€ä¸ªç®€å•çš„ webæ¡†æ¶ï¼Œä»è€Œæ˜ç™½äº† webæ¡†æ¶æ‰€éœ€è¦çš„ç‰¹æ€§ï¼Œè¿˜è¿¸å‘å‡ºå°è£… gin çš„æƒ³æ³•ã€‚\nwebæ¡†æ¶ æ‰€éœ€è¦çš„ç‰¹æ€§ åˆ†ç»„æ§åˆ¶ åˆ†ç»„æ§åˆ¶ (Group Control)æ˜¯ Web æ¡†æ¶åº”å½“æä¾›çš„åŸºç¡€åŠŸèƒ½ï¼Œæœ‰äº†åˆ†ç»„ä¸åˆ†ç»„åµŒå¥—ï¼Œç³»ç»Ÿæ‰å¯ä»¥æ›´æ–¹ä¾¿çš„ç®¡ç†ä¸åŒçš„ä¸šåŠ¡ï¼Œæ­é…ä¸­é—´ä»¶ï¼Œå°±å¯ä»¥å¤„ç†åŒç»„ä¸‹çš„å…¬å…±é€»è¾‘ã€‚\nä¸­é—´ä»¶ ä¸­é—´ä»¶ (Middleware)æ˜¯ web æ¡†æ¶çš„çµé­‚ï¼Œä¸º web æ¡†æ¶æä¾›æ— é™çš„æ‰©å±•èƒ½åŠ›ã€‚æœ‰äº†ä¸­é—´ä»¶ï¼Œå¯ä»¥åªå¯¹ admin å’Œ api åˆ†ç»„è¿›è¡Œé‰´æƒï¼Œå¯¹ç‰¹å®šæ¥å£é™æµã€‚å¯¹æœ€é¡¶å±‚ç›®å½• \u0026ldquo;/\u0026quot;ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªç³»ç»Ÿï¼Œå¯ä»¥é…ç½®æ—¥å¿—ï¼Œè¯·æ±‚è€—æ—¶ç­‰åŠŸèƒ½ã€‚\nåŠ¨æ€è·¯ç”± åŠ¨æ€è·¯ç”± (Dynamic Route)ï¼Œæœ¬è´¨ä¸Šåªæ˜¯å°†å‚æ•°ç»™æ˜ å°„ä¸ºè·¯å¾„çš„ä¸€éƒ¨åˆ†äº†ï¼Œæ¯”å¦‚ https://github.com/niluan304 å’Œ https://github.com/?user=niluan304 å¯¹äºåç«¯æ¥è®²å¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚ä¸è¿‡åŠ¨æ€è·¯ç”±è¿˜æ˜¯æœ‰ä¼˜åŠ¿çš„ï¼š\næé«˜SEOï¼šæœç´¢å¼•æ“è§£æé™æ€URLæ›´ä¸ºè½»æ¾ï¼ŒåŠ¨æ€è·¯ç”±å°†å‚æ•°å†…åµŒè‡³URLä¸­ï¼Œå¯ä»¥æé«˜SEOæ•ˆæœã€‚ å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼šç°é˜¶æ®µçš„åŠ¨æ€è·¯ç”±å¯ä»¥æœ‰å¤šä¸ªå‚æ•°ï¼Œå¦‚ /user/:name/article/:articleIdï¼Œå¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§æ˜æ˜¾é«˜äº user/article?name=zwei\u0026amp;?articleId=1234ã€‚ å¯æ‹“å±•æ€§ï¼šåŠ¨æ€è·¯ç”±å¯ä»¥ä½¿ç”¨å‰ç¼€è¿›è¡Œåˆ†ç»„ï¼Œè¿™æ ·å¯ä»¥å¾ˆå®¹æ˜“æ·»åŠ å’Œä¿®æ”¹åŒä¸€åˆ†ç»„ä¸‹çš„ä¸­é—´ä»¶ã€‚ gin ä¸ GoFrame çš„å·®å¼‚ å®ç°ç®€æ˜“webæ¡†æ¶ä¹‹åï¼Œæ‰ç®—ç†è§£ gin çš„ä¸­é—´ä»¶ä¸ä¸šåŠ¡ä»£ç çš„æ ¼å¼ä¸ºä»€ä¹ˆå¿…é¡»ä¸ºï¼š\nfunc(c *gin .Context) { // ä¸­é—´ä»¶ æˆ– ä¸šåŠ¡ä»£ç é€»è¾‘ } ä½†æ˜¯è¿™å’Œç¬”è€…æœ€ç†Ÿæ‚‰çš„ GoFrame æ¡†æ¶æœ‰ä¸€äº›å·®å¼‚ï¼ŒGoFrame è¿˜é¢å¤–æ”¯æŒå¦ä¸€ç§å†™æ³•ï¼š\n// ä¸­é—´ä»¶å¼å†™æ³•ï¼Œç±»ä¼¼ gin çš„ func(c *gin .Context) func (r *ghttp.Request) { // ä¸­é—´ä»¶ æˆ– ä¸šåŠ¡ä»£ç é€»è¾‘ } // å†™æ³•äºŒ func (ctx context.Context, req *{Prefix}Req) (res *{Prefix}Res, err error){ // ä¸šåŠ¡ä»£ç é€»è¾‘ } å¸¦ç€ç–‘é—®ï¼Œç¬”è€…æ¢ç©¶äº†ä¸¤ä¸ªæ¡†æ¶ä¹‹é—´çš„å·®å¼‚ï¼Œå¹¶å°è¯•å°† gin çš„æ¥å£æ”¹é€ ä¸º GoFrame æ ¼å¼ã€‚ æ€»ç»“åå¯ä»¥æ¦‚æ‹¬ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œè¿™ç®—æ˜¯ã€Œ7å¤©æ•™ç¨‹ã€çš„è¯»åæ„Ÿï¼Œç¬”è€…ä¹Ÿä»¿ç…§å‘½åä¸ºï¼š\nday8 åˆ†å±‚è®¾è®¡çš„å¿…è¦æ€§ day9 ååºåˆ—åŒ–ä¸è§£è€¦ day10 é€šè¿‡åå°„æ„é€ è§„èŒƒè·¯ç”± ","date":"2023-12-19T11:27:57+08:00","permalink":"https://niluan304.github.io/p/gee-web-day7.5-7%E5%A4%A9-web%E6%A1%86%E6%9E%B6%E8%AF%BB%E5%90%8E%E6%84%9F/","title":"gee-web-day7.5 ã€Œ7å¤© webæ¡†æ¶ã€è¯»åæ„Ÿ"},{"content":"åœ¨å›½å†…æ‰§è¡Œ git clone https://github.com/golang/go.git æ“ä½œï¼Œåˆæ…¢åˆä¸ç¨³å®šï¼Œæœç´¢åå‘ç°å¯ä»¥ä½¿ç”¨ä»£ç†è¿™ä¸ªé—®é¢˜ã€‚\nå‡†å¤‡å·¥ä½œ é¦–å…ˆï¼Œä½ éœ€è¦å‡†å¤‡å¥½ä»£ç†å·¥å…·ï¼Œä¸€èˆ¬çš„ä»£ç†å·¥å…·éƒ½æœ‰ Sock5 å’Œ HTTP ä¸¤ç§ä»£ç†æ–¹å¼ã€‚\nå¸¸è§çš„ä»£ç†è½¯ä»¶ä½¿ç”¨çš„ç«¯å£æœ‰ï¼š7890, 1080ï¼Œä¸‹æ–‡çš„ {port} å‚æ•°éƒ½éœ€è¦ä¿®æ”¹ä¸ºå¯¹åº”çš„ç«¯å£å·ã€‚\nç¬”è€…ä¼šæŒ‰ç…§ Windows å’Œ ç±» Unix ç³»ç»Ÿä»‹ç»ä¸º git è®¾ç½®ä»£ç†çš„æ–¹æ³•ï¼Œç”±äºç›¸ä¼¼å¤„å¾ˆå¤šï¼Œè¯·æŒ‰éœ€æŸ¥çœ‹ã€‚\nWindows ä¸‹ ä¸º HTTP åè®®è®¾ç½®ä»£ç† åœ¨ GitHubä¸Šï¼Œé€šè¿‡ç¬¬ä¸€ç§æ–¹å¼å…‹éš†ä»“åº“ï¼Œè¿™é‡Œèµ°çš„å°±æ˜¯ HTTP åè®®ï¼Œä¿®æ”¹èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼š\nå‘½ä»¤è¡Œè®¾ç½® é€šè¿‡ä»£ç†è½¯ä»¶ HTTP çš„ç«¯å£ åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š # {port} ä¿®æ”¹ä¸ºä»£ç†è½¯ä»¶çš„ç«¯å£ git config --global https.https://github.com.proxy https://127.0.0.1:{port} é€šè¿‡ä»£ç†è½¯ä»¶ Sock5 çš„ç«¯å£ åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š # {port} ä¿®æ”¹ä¸ºä»£ç†è½¯ä»¶çš„ç«¯å£ git config --global https.https://github.com.proxy socks5://127.0.0.1:{port} å¯ä»¥å‘ç°ï¼Œä¸¤è€…çš„å‘½ä»¤æå…¶ç›¸ä¼¼ï¼Œæ ¼å¼éƒ½ä¸ºï¼š\ngit config --global https.https://github.com.proxy {protocol}://{ip}:{port} æ‰€ä»¥ï¼Œå‡­ä¸ªäººå–œå¥½ä½¿ç”¨å°±å¥½ã€‚\nå¦å¤–ï¼Œå¦‚æœä»£ç†è½¯ä»¶å¹¶ä¸åœ¨æœ¬åœ°è¿è¡Œï¼Œé‚£ä¹ˆå°±å°† 127.0.0.1 ä¿®æ”¹ä¸ºä»£ç†è½¯ä»¶æœåŠ¡å™¨çš„ ipï¼ˆéœ€è¦æœ‰è®¿é—®æƒé™ï¼‰ã€‚\nä¿®æ”¹ .gitconfig æ–‡ä»¶ å¦‚æœä¸å–œæ¬¢åœ¨å‘½ä»¤è¡Œä¸­æ“ä½œï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹ C:/Users/${your username}/.gitconfig æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\né€šè¿‡ä»£ç†è½¯ä»¶ HTTP çš„ç«¯å£ [https \u0026#34;https://github.com\u0026#34;] # {port} ä¿®æ”¹ä¸ºä»£ç†è½¯ä»¶çš„ç«¯å£ proxy = https://127.0.0.1:{port} é€šè¿‡ä»£ç†è½¯ä»¶ Sock5 çš„ç«¯å£ [http \u0026#34;https://github.com\u0026#34;] # {port} ä¿®æ”¹ä¸ºä»£ç†è½¯ä»¶çš„ç«¯å£ proxy = socks5://127.0.0.1:{port} å–æ¶ˆä»£ç† é€šè¿‡å‘½ä»¤è¡Œï¼š\ngit config --global --unset https.https://github.com.proxy ä¹Ÿå¯ä»¥ä¿®æ”¹ C:/Users/${your username}/.gitconfig æ–‡ä»¶ï¼Œåˆ é™¤æˆ–æ³¨é‡Š [https \u0026quot;https://github.com\u0026quot;] åŒºåŸŸçš„å†…å®¹ã€‚\nä¸º SSH åè®®è®¾ç½®ä»£ç† åœ¨ GitHubä¸Šï¼Œé€šè¿‡ç¬¬äºŒç§æ–¹å¼å…‹éš†ä»“åº“ï¼Œèµ°çš„å°±æ˜¯ SSH åè®®ï¼š\nä¿®æ”¹ .ssh/config æ–‡ä»¶ æ‰¾åˆ° ~/.ssh ç›®å½•ä¸‹çš„ config æ–‡ä»¶ï¼ˆå¦‚æœæ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆæ–°å»ºå³å¯ï¼‰ã€‚\né€šè¿‡ä»£ç†è½¯ä»¶ HTTP çš„ç«¯å£ config æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š Host github.com Hostname ssh.github.com # git åœ¨ window ä¸‹ä½¿ç”¨çš„ä»£ç†è½¯ä»¶ä¸º connect # -Hä¸ºHTTPåè®®ï¼Œ -SæŒ‡Socks 5åè®® # {port} ä¿®æ”¹ä¸ºä»£ç†è½¯ä»¶çš„ç«¯å£ ProxyCommand connect -H 127.0.0.1:{port} %h %p # æœåŠ¡å¯¹åº”ç«¯å£ Port 443 é€šè¿‡ä»£ç†è½¯ä»¶ Sock5 çš„ç«¯å£ config æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š Host github.com Hostname ssh.github.com # git åœ¨ window ä¸‹ä½¿ç”¨çš„ä»£ç†è½¯ä»¶ä¸º connect # -Hä¸ºHTTPåè®®ï¼Œ -SæŒ‡Socks 5åè®® # {port} ä¿®æ”¹ä¸ºä»£ç†è½¯ä»¶çš„ç«¯å£ ProxyCommand connect -S 127.0.0.1:{port} %h %p # æœåŠ¡å¯¹åº”ç«¯å£ Port 443 éªŒè¯ å…ˆæ‰“å¼€ git bash ï¼Œç„¶åæ‰§è¡Œï¼š\nssh -T git@github.com` ç»“æœç±»ä¼¼ï¼š\n$ ssh -T git@github.com Hi niluan304! You\u0026#39;ve successfully authenticated, but GitHub does not provide shell access. ç±» Unix ç³»ç»Ÿ ä¸º HTTP åè®®è®¾ç½®ä»£ç† åœ¨ GitHubä¸Šï¼Œé€šè¿‡ç¬¬ä¸€ç§æ–¹å¼å…‹éš†ä»“åº“ï¼Œè¿™é‡Œèµ°çš„å°±æ˜¯ HTTP åè®®ï¼Œä¿®æ”¹èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼š\nå‘½ä»¤è¡Œè®¾ç½® é€šè¿‡ä»£ç†è½¯ä»¶ HTTP çš„ç«¯å£ åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š # {port} ä¿®æ”¹ä¸ºä»£ç†è½¯ä»¶çš„ç«¯å£ git config --global https.https://github.com.proxy https://127.0.0.1:{port} é€šè¿‡ä»£ç†è½¯ä»¶ Sock5 çš„ç«¯å£ åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š # {port} ä¿®æ”¹ä¸ºä»£ç†è½¯ä»¶çš„ç«¯å£ git config --global https.https://github.com.proxy socks5://127.0.0.1:{port} å¯ä»¥å‘ç°ï¼Œä¸¤è€…çš„å‘½ä»¤æå…¶ç›¸ä¼¼ï¼Œæ ¼å¼éƒ½ä¸ºï¼š\ngit config --global https.https://github.com.proxy {protocol}://{ip}:{port} æ‰€ä»¥ï¼Œå‡­ä¸ªäººå–œå¥½ä½¿ç”¨å°±å¥½ã€‚\nå¦å¤–ï¼Œå¦‚æœä»£ç†è½¯ä»¶å¹¶ä¸åœ¨æœ¬åœ°è¿è¡Œï¼Œé‚£ä¹ˆå°±å°† 127.0.0.1 ä¿®æ”¹ä¸ºä»£ç†è½¯ä»¶æœåŠ¡å™¨çš„ ipï¼ˆéœ€è¦æœ‰è®¿é—®æƒé™ï¼‰ã€‚\nä¿®æ”¹ .gitconfig æ–‡ä»¶ å¦‚æœä¸å–œæ¬¢åœ¨å‘½ä»¤è¡Œä¸­æ“ä½œï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹ ~/.gitconfig æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\né€šè¿‡ä»£ç†è½¯ä»¶ HTTP çš„ç«¯å£ [https \u0026#34;https://github.com\u0026#34;] # {port} ä¿®æ”¹ä¸ºä»£ç†è½¯ä»¶çš„ç«¯å£ proxy = https://127.0.0.1:{port} é€šè¿‡ä»£ç†è½¯ä»¶ Sock5 çš„ç«¯å£ [http \u0026#34;https://github.com\u0026#34;] # {port} ä¿®æ”¹ä¸ºä»£ç†è½¯ä»¶çš„ç«¯å£ proxy = socks5://127.0.0.1:{port} å–æ¶ˆä»£ç† é€šè¿‡å‘½ä»¤è¡Œï¼š\ngit config --global --unset https.https://github.com.proxy ä¹Ÿå¯ä»¥ä¿®æ”¹ ~/.gitconfig æ–‡ä»¶ï¼Œåˆ é™¤æˆ–æ³¨é‡Š [https \u0026quot;https://github.com\u0026quot;] åŒºåŸŸçš„å†…å®¹ã€‚\nä¸º SSH åè®®è®¾ç½®ä»£ç† åœ¨ GitHubä¸Šï¼Œé€šè¿‡ç¬¬äºŒç§æ–¹å¼å…‹éš†ä»“åº“ï¼Œèµ°çš„å°±æ˜¯ SSH åè®®ï¼š\nä¿®æ”¹ .ssh/config æ–‡ä»¶ æ‰¾åˆ° ~/.ssh ç›®å½•ä¸‹çš„ config æ–‡ä»¶ï¼ˆå¦‚æœæ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆæ–°å»ºå³å¯ï¼‰ã€‚\né€šè¿‡ä»£ç†è½¯ä»¶ HTTP çš„ç«¯å£ config æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š Host github.com Hostname ssh.github.com # git åœ¨ Linux å’Œ Mac ä¸‹ä½¿ç”¨çš„ä»£ç†è½¯ä»¶ä¸º netcatï¼Œç®€ç§°ncã€‚ # -X 5 æŒ‡ä»£ç†åè®®Socks 5ï¼Œ -X 4 æŒ‡ä»£ç†åè®®Socks 4ï¼Œ -X connectæŒ‡ä»£ç†åè®®Socks HTTP ProxyCommand nc -v -X 127.0.0.1:xxxx %h %p # æœåŠ¡å¯¹åº”ç«¯å£ Port 443 é€šè¿‡ä»£ç†è½¯ä»¶ Sock5 çš„ç«¯å£ config æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š Host github.com Hostname ssh.github.com # git åœ¨ Linux å’Œ Mac ä¸‹ä½¿ç”¨çš„ä»£ç†è½¯ä»¶ä¸º netcatï¼Œç®€ç§°ncã€‚ # -X 5 æŒ‡ä»£ç†åè®®Socks 5ï¼Œ -X 4 æŒ‡ä»£ç†åè®®Socks 4ï¼Œ -X connectæŒ‡ä»£ç†åè®®Socks HTTP ProxyCommand nc -v -X 5 127.0.0.1:xxxx %h %p # æœåŠ¡å¯¹åº”ç«¯å£ Port 443 éªŒè¯ å…ˆæ‰“å¼€ git bash ï¼Œç„¶åæ‰§è¡Œï¼š\nssh -T git@github.com ç»“æœç±»ä¼¼ï¼š\n$ ssh -T git@github.com Hi niluan304! You\u0026#39;ve successfully authenticated, but GitHub does not provide shell access. å¦‚æœé‡åˆ°é”™è¯¯ï¼Œå¯ä»¥åˆ é™¤ .ssh ç›®å½•ä¸­ known_hosts æ–‡ä»¶åé‡è¯•ã€‚\n","date":"2023-03-14T18:08:02+08:00","permalink":"https://niluan304.github.io/p/%E4%B8%BA-git-clone-github-%E8%AE%BE%E7%BD%AE-http-%E5%92%8C-ssh-%E4%BB%A3%E7%90%86/","title":"ä¸º git clone github è®¾ç½® HTTP å’Œ SSH ä»£ç†"},{"content":"ä½¿ç”¨ slices.Sort å’Œ slices.SortFunc é¿å… sort.Slices çš„å‘\nsort.Slices ä»‹ç» sort.Slices æ˜¯go äº1.18 ç‰ˆæœ¬æ–°å¢çš„æ’åºå‡½æ•°ï¼Œç­¾åå¦‚ä¸‹ï¼š\nfunc Slice(x any, less func(i, j int) bool) ä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼š\nfunc main() { type Student struct { Name string Age int } students := []Student{ {Name: \u0026#34;Gopher\u0026#34;, Age: 14}, {Name: \u0026#34;Carol\u0026#34;, Age: 10}, {Name: \u0026#34;Alice\u0026#34;, Age: 10}, {Name: \u0026#34;Bob\u0026#34;, Age: 15}, {Name: \u0026#34;Dave\u0026#34;, Age: 12}, } // sort by Age first, Name second sort.Slice(students, func(i, j int) bool { x, y := students[i], students[j] if x.Age != y.Age { return x.Age \u0026lt; y.Age } return x.Name \u0026lt; y.Name }) for _, student := range students { fmt.Printf(\u0026#34;%d %s\\n\u0026#34;, student.Age, student.Name) } } // Output: // 10 Alice // 10 Carol // 12 Dave // 14 Gopher // 15 Bob é—­åŒ…çš„å‘ ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç”šè‡³è¿›è¡Œäº†å¤šå­—æ®µæ’åºã€‚ä½†å¦‚æœæˆ‘ä»¬åªéœ€è¦éƒ¨åˆ†æ’åºï¼Œä»£ç åˆè¯¥æ€ä¹ˆå†™å‘¢ï¼Ÿ\nè¿™æ ·å¯¹å—ï¼Ÿ\nfunc SortAfter(nums []int, p int) { // ä»på¼€å§‹æ’åº sort.Slice(nums[p:], func(i, j int) bool { return nums[i] \u0026lt; nums[j] }) } å’‹ä¸€çœ‹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œè·‘ä¸‹æµ‹è¯•ç”¨ä¾‹å§ï¼š\nfunc main() { nums := []int{2, 3, 1, 5, 4, 6, 7} tests := []struct { p int want []int }{ {p: 1, want: []int{2, 1, 3, 4, 5, 6, 7}}, {p: 2, want: []int{2, 3, 1, 4, 5, 6, 7}}, {p: 3, want: []int{2, 3, 1, 4, 5, 6, 7}}, } for _, tt := range tests { got := slices.Clone(nums) // æ‹·è´åŸå§‹æ•°æ®ï¼Œç”¨äºæµ‹è¯• SortAfter(got, tt.p) if !reflect.DeepEqual(got, tt.want) { fmt.Printf(\u0026#34;when p: %v ,want: %v, but got: %v\\n\u0026#34;, tt.p, tt.want, got) } } } // Output: // when p: 1 ,want: [2 1 3 4 5 6 7], but got: [2 3 5 6 7 4 1] // when p: 3 ,want: [2 3 1 4 5 6 7], but got: [2 3 1 5 6 4 7] ä¸ºä»€ä¹ˆ p = 1,3 æ—¶ä¸å¯¹ï¼Œp = 2 æ—¶åˆæ˜¯å¯¹çš„å‘¢ï¼Ÿ å› ä¸º sort.Slices æ¥æ”¶åˆ°çš„å‚æ•°æ˜¯ nums[p:]ï¼Œless é—­åŒ…é‡Œçš„å‚æ•° i, j æ˜¯åœ¨ nums[p:] çš„ä½ç½®ï¼Œå¦‚æœç›´æ¥æ¯”è¾ƒ nums[i] å’Œnums[j]ï¼Œé‚£å°±å¿½ç•¥äº† p åç§»çš„å½±å“ï¼Œæ‰€ä»¥å®é™…è¦æ¯”è¾ƒçš„å…ƒç´ å…¶å®æ˜¯ nums[i+p] å’Œ nums[j+p]ï¼Œé‚£ä¹ˆä¿®å¤åçš„å‡½æ•°ï¼š\nfunc SortAfter(nums []int, p int) { // ä»på¼€å§‹æ’åº sort.Slice(nums[p:], func(i, j int) bool { // è¿™é‡Œä¼ å…¥çš„sliceä¸å†æ˜¯å®Œæ•´çš„numsï¼Œè€Œæ˜¯nums[p:] return nums[i+p] \u0026lt; nums[j+p] }) } ä½¿ç”¨ slices.Sort ä¼˜åŒ– æ‰‹åŠ¨ä¿®æ­£åç§»é‡ï¼Œå¯ä»¥é¿å…éƒ¨åˆ†æ’åºè¿™ä¸ªå‘ä¸€æ—¶ï¼Œä½†æ—¥åä¾æ—§æœ‰å¯èƒ½å› ä¸ºæ€ç»´æƒ¯æ€§è€Œå¯¼è‡´å†æ¬¡è¸©å‘ã€‚å…·ä½“å®ç°ä¹Ÿå¾ˆåˆ«æ‰­ï¼Œä¹Ÿä¸æ–¹ä¾¿ä¿®æ”¹ã€‚\nå¥½åœ¨ go åœ¨ 1.21 ç‰ˆæœ¬æ–°å¢äº†äº† slices è¿™ä¸ªæ³›å‹åº“ï¼Œé‡Œé¢åŒ…å«äº†å¾ˆå¤šåˆ‡ç‰‡çš„é€šç”¨æ“ä½œï¼Œå…¶ä¸­çš„ slices.Sort å’Œ slices.SortFunc å‡½æ•°å°±å¯ä»¥é¿å…ä¸Šé¢çš„å‘ã€‚\nè¿™ä¸¤ä¸ªå‡½æ•°çš„ç­¾åï¼š\nfunc Sort[S ~[]E, E cmp.Ordered](x S) func SortFunc[S ~[]E, E any](x S, cmp func(a, b E) int) ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥ä¼ å…¥è¦æ’åºçš„éƒ¨åˆ†ï¼Œå¦‚æœè°ƒç”¨ slices.Sortï¼Œè¿˜å¯ä»¥çœå»ç”¨æ‰‹å†™ less é—­åŒ…å‡½æ•°ã€‚ æœ€é‡è¦çš„æ˜¯ï¼ŒæŒ‰ç…§ç›´è§‰ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°å°±å¯ä»¥é¿å… sort.Slices åœ¨éƒ¨åˆ†æ’åºæ—¶çš„å‘ï¼š\nfunc main() { nums := []int{2, 3, 1, 5, 4, 6, 7} tests := []struct { p int want []int }{ {p: 0, want: []int{1, 2, 3, 4, 5, 6, 7}}, {p: 1, want: []int{2, 1, 3, 4, 5, 6, 7}}, {p: 2, want: []int{2, 3, 1, 4, 5, 6, 7}}, {p: 3, want: []int{2, 3, 1, 4, 5, 6, 7}}, } for _, tt := range tests { got := slices.Clone(nums) // æ‹·è´åŸå§‹æ•°æ®ï¼Œç”¨äºæµ‹è¯• slices.Sort(got[tt.p:]) if !reflect.DeepEqual(got, tt.want) { fmt.Printf(\u0026#34;when p: %v ,want: %v, but got: %v\\n\u0026#34;, tt.p, tt.want, got) } } } è€Œä½¿ç”¨ sort.SortFuncï¼Œæ­é… go 1.22 æ–°å¢çš„æ³›å‹å‡½æ•° cmp.Orï¼Œå¯ä»¥æ›´è½»æ¾çš„å®ç°å¤šå­—æ®µæ’åºï¼Œè¿™æ®µä»£ç æ¥è‡ª go1.22 æ ‡å‡†åº“ cmp/cmp_test.goï¼š\nfunc main() { type Order struct { Product string Customer string Price float64 } orders := []Order{ {\u0026#34;foo\u0026#34;, \u0026#34;alice\u0026#34;, 1.00}, {\u0026#34;bar\u0026#34;, \u0026#34;bob\u0026#34;, 3.00}, {\u0026#34;baz\u0026#34;, \u0026#34;carol\u0026#34;, 4.00}, {\u0026#34;foo\u0026#34;, \u0026#34;alice\u0026#34;, 2.00}, {\u0026#34;bar\u0026#34;, \u0026#34;carol\u0026#34;, 1.00}, {\u0026#34;foo\u0026#34;, \u0026#34;bob\u0026#34;, 4.00}, } // Sort by customer first, product second, and last by higher price slices.SortFunc(orders, func(a, b Order) int { return cmp.Or( cmp.Compare(a.Customer, b.Customer), cmp.Compare(a.Product, b.Product), cmp.Compare(b.Price, a.Price), ) }) for _, order := range orders { fmt.Printf(\u0026#34;%s %s %.2f\\n\u0026#34;, order.Product, order.Customer, order.Price) } } // Output: // foo alice 2.00 // foo alice 1.00 // bar bob 3.00 // foo bob 4.00 // bar carol 1.00 // baz carol 4.00 å…¶ä¸­ cmp.Or çš„æºç  éå¸¸ç®€å•ï¼Œåªæ˜¯ç”¨äºæ‰¾å‡ºåˆ‡ç‰‡ä¸­ç¬¬ä¸€ä¸ªéé›¶çš„å…ƒç´ ï¼š\n// Or returns the first of its arguments that is not equal to the zero value. // If no argument is non-zero, it returns the zero value. func Or[T comparable](vals ...T) T { var zero T for _, val := range vals { if val != zero { return val } } return zero } å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ ·å†™ less å‡½æ•°ï¼Œæ¯”æ‰‹å†™å¤šä¸ª if ä¼˜é›…å¤ªå¤šäº†ã€‚\nå‚è€ƒèµ„æ–™ golang sort.Sliceè¸©å‘è®°å½• - ç®€ä¹¦ ","date":"2023-03-11T00:00:00Z","image":"https://niluan304.github.io/p/sort.slice-%E4%B8%8D%E9%80%82%E5%90%88%E9%83%A8%E5%88%86%E6%8E%92%E5%BA%8F/Feng_2024-03-12_10-13-25_huca69348bf10406e412f1d3e0ec3bf9be_11506_120x120_fill_box_smart1_3.png","permalink":"https://niluan304.github.io/p/sort.slice-%E4%B8%8D%E9%80%82%E5%90%88%E9%83%A8%E5%88%86%E6%8E%92%E5%BA%8F/","title":"sort.Slice ä¸é€‚åˆéƒ¨åˆ†æ’åº"},{"content":"wsl å¸¸ç”¨å‘½ä»¤ é‡å¯ wsl å°è¯•é‡å¯ wslï¼Œä½¿ç”¨å‘½ä»¤ wsl --shuntdown æˆ–å…¶ä»–å‘½ä»¤ï¼Œç»ˆç«¯è¢«æŒ‚èµ·ï¼Œæ— ååº”ã€‚\nè§£å†³åŠæ³•ï¼škill LxssManager\næ‰¾åˆ° svchost.exe è¿›ç¨‹çš„ pid, ç„¶ååœ¨ã€Œä»»åŠ¡ç®¡ç†å™¨/è¯¦ç»†ä¿¡æ¯ã€é‡Œç»“æŸè¿™ä¸ªè¿›ç¨‹ echo å¯»æ‰¾ `pid` çš„æŒ‡ä»¤ï¼š tasklist /svc /fi \u0026#34;imagename eq svchost.exe\u0026#34; | findstr LxssManager PowerShell7 é‡Œ kill LxssManager echo åœ¨ `PowerShell7` é‡Œè¿è¡Œï¼ˆå¯èƒ½éœ€è¦ç®¡ç†å‘˜å¯åŠ¨ï¼‰ï¼š Stop-Process -Id $(Get-CimInstance -ClassName Win32_Service -Filter \u0026#34;Name=\u0026#39;LxssManager\u0026#39;\u0026#34;).ProcessId -Force å®‰è£… docker æœ€ç®€å•çš„åŠæ³•ï¼Œå¤§æ¦‚æ˜¯å®‰è£… Docker Desktopï¼Œç¬”è€…ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œä¼¼ä¹æœ‰å…¼å®¹æ€§é—®é¢˜ï¼ˆå¯èƒ½å’Œç¬”è€…åŒæ—¶ä½¿ç”¨ Hyper-V å®‰å“æ¨¡æ‹Ÿå™¨æœ‰å…³ç³»ï¼‰ï¼Œäºæ˜¯åˆæ›´æ¢ä¸º Linux ç‰ˆæœ¬çš„ dockerã€‚\nç›´æ¥è¿è¡Œå®˜æ–¹çš„è„šæœ¬ï¼Œå³å¯å®Œæˆå®‰è£…ï¼š\ncurl -fsSL https://get.docker.com -o get-docker.sh sudo sh get-docker.sh sudo service docker start ä½†æ˜¯ç¬”è€…çš„æœºå™¨å®‰è£…è¿‡ Docker Desktopï¼Œè¿è¡Œ service docker start åæ˜¾ç¤ºï¼š\nCannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running? ç»è¿‡æ’æŸ¥ï¼Œå‘ç°è¿˜éœ€è¦æ¸…ç† Docker Desktop ç›¸å…³çš„é…ç½®ã€‚å®‰è£…è¿‡ Docker Desktopï¼Œæ‰€ä»¥ docker çš„é…ç½®æ–‡ä»¶ /root/.docker/config.json å«æœ‰è¿™ä¸ªé…ç½®é¡¹ï¼š\n{ \u0026#34;credsStore\u0026#34;: \u0026#34;desktop.exe\u0026#34; } docker ä¼šå› ä¸ºé…ç½®äº† \u0026quot;credsStore\u0026quot; å­—æ®µå»è¿è¡Œ \u0026quot;desktop.exe\u0026quot;ï¼Œè€Œè¿™ä¸ªç¨‹åºå°±æ˜¯ Docker Desktpoï¼Œæ‰å¯¼è‡´ docker æ— æ³•å¯åŠ¨ã€‚\nè§£å†³åŠæ³•ï¼š\nåˆ é™¤ docker é…ç½®æ–‡ä»¶é‡Œçš„ \u0026quot;credsStore\u0026quot; å­—æ®µã€‚ å¦‚æœé‡Œé¢çš„é…ç½®ä¸é‡è¦ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åˆ é™¤è¿™ä¸ªæ–‡ä»¶ï¼šrm /root/.docker/config.jsonã€‚ ","date":"2023-02-10T10:28:36+08:00","permalink":"https://niluan304.github.io/p/wsl-%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/","title":"Wsl ä½¿ç”¨ç¬”è®°"}]