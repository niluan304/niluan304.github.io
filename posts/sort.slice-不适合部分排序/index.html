<!DOCTYPE html>
<html><head>
<title>sort.Slice 不适合部分排序</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="对切片排序时，应当放弃 sort.Slice，去选择 slices.Sort 或 slices.SortFunc">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="sort.Slice 不适合部分排序" />
<meta property="og:description" content="对切片排序时，应当放弃 sort.Slice，去选择 slices.Sort 或 slices.SortFunc" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://niluan304.github.io/posts/sort.slice-%E4%B8%8D%E9%80%82%E5%90%88%E9%83%A8%E5%88%86%E6%8E%92%E5%BA%8F/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-11T17:15:51+08:00" />
<meta property="article:modified_time" content="2024-03-11T17:15:51+08:00" /><meta property="og:site_name" content="My Blog" />






<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="sort.Slice 不适合部分排序"/>
<meta name="twitter:description" content="对切片排序时，应当放弃 sort.Slice，去选择 slices.Sort 或 slices.SortFunc"/>









<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "abcdefghzd");
</script>



  




<link rel="icon" href="https://niluan304.github.io/static/favicon.ico">



      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css" integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>















<script>console.log("Hello from 'layouts/partials/extended_head.html'")</script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css" integrity="sha384-TEMocfGvRuD1rIAacqrknm5BQZ7W7uWitoih+jMNFXQIbNl16bO8OZmylH/Vi/Ei" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.js" integrity="sha384-jmxIlussZWB7qCuB+PgKG1uLjjxbVVIayPJwi6cG6Zb4YKq0JIw+OMnkkEC7kYCq" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/contrib/auto-render.min.js" integrity="sha384-IiI65aU9ZYub2MY9zhtKd1H2ps7xxf+eb2YFG9lX6uRqpXCvBTOidPRCXCrQ++Uc" crossorigin="anonymous"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body);
    });
</script>

</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#sortslices-%e4%bb%8b%e7%bb%8d" class="nav-sortslices-介绍">
									sort.Slices 介绍
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%97%ad%e5%8c%85%e7%9a%84%e5%9d%91" class="nav-闭包的坑">
									闭包的坑
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8-slicessort-%e4%bc%98%e5%8c%96" class="nav-使用-slicessort-优化">
									使用 slices.Sort 优化
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99" class="nav-参考资料">
									参考资料
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://niluan304.github.io/">
            雾封的笔
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://niluan304.github.io/">
        <div class="single-column-header-title">雾封的笔</div>
        
        <div class="single-column-header-subtitle">脚步不停，灿若繁星。</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://niluan304.github.io/images/Feng_2023-09-21_11-48-20.gif')"
                    
                
            >
                <div class="post-title">
                    sort.Slice 不适合部分排序
                    
                    <div class="post-subtitle">
                        对切片排序时，应当放弃 sort.Slice，去选择 slices.Sort 或 slices.SortFunc
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2024-03-11 17:15
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/go">go</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/go">go</a>
                                &nbsp;
                            
                                <a href="/tags/sort">sort</a>
                                &nbsp;
                            
                                <a href="/tags/slice">slice</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <p>使用 <code>slices.Sort</code> 和  <code>slices.SortFunc</code>  避免 <code>sort.Slices</code> 的坑</p>
<h2 id="sortslices-介绍">sort.Slices 介绍</h2>
<p><code>sort.Slices</code> 是go 于1.18 版本新增的排序函数，签名如下：</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#e78284">func</span> <span style="color:#8caaee">Slice</span>(x any, less <span style="color:#e78284">func</span>(i, j <span style="color:#e78284">int</span>) <span style="color:#e78284">bool</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用起来非常简单：</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#e78284">func</span> <span style="color:#8caaee">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">type</span> Student <span style="color:#e78284">struct</span> {
</span></span><span style="display:flex;"><span>		Name <span style="color:#e78284">string</span>
</span></span><span style="display:flex;"><span>		Age  <span style="color:#e78284">int</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	students <span style="color:#99d1db;font-weight:bold">:=</span> []Student{
</span></span><span style="display:flex;"><span>		{Name: <span style="color:#a6d189">&#34;Gopher&#34;</span>, Age: <span style="color:#ef9f76">14</span>},
</span></span><span style="display:flex;"><span>		{Name: <span style="color:#a6d189">&#34;Carol&#34;</span>, Age: <span style="color:#ef9f76">10</span>},
</span></span><span style="display:flex;"><span>		{Name: <span style="color:#a6d189">&#34;Alice&#34;</span>, Age: <span style="color:#ef9f76">10</span>},
</span></span><span style="display:flex;"><span>		{Name: <span style="color:#a6d189">&#34;Bob&#34;</span>, Age: <span style="color:#ef9f76">15</span>},
</span></span><span style="display:flex;"><span>		{Name: <span style="color:#a6d189">&#34;Dave&#34;</span>, Age: <span style="color:#ef9f76">12</span>},
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	sort.<span style="color:#8caaee">Slice</span>(students, <span style="color:#e78284">func</span>(i, j <span style="color:#e78284">int</span>) <span style="color:#e78284">bool</span> {
</span></span><span style="display:flex;"><span>		x, y <span style="color:#99d1db;font-weight:bold">:=</span> students[i], students[j]
</span></span><span style="display:flex;"><span>		<span style="color:#ca9ee6">if</span> x.Age <span style="color:#99d1db;font-weight:bold">!=</span> y.Age {
</span></span><span style="display:flex;"><span>			<span style="color:#ca9ee6">return</span> x.Age &lt; y.Age
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#ca9ee6">return</span> x.Name &lt; y.Name
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#8caaee">Println</span>(<span style="color:#a6d189">&#34;sort by Age first, Name second:&#34;</span>, students)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// Output:
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// sort by Age first, Name second: [{Alice 10} {Carol 10} {Dave 12} {Gopher 14} {Bob 15}]
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="闭包的坑">闭包的坑</h2>
<p>上面的代码中，甚至进行了多字段排序。但如果我们只需要部分排序，代码又该怎么写呢？</p>
<p>这样对吗？</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#e78284">func</span> <span style="color:#8caaee">SortAfter</span>(nums []<span style="color:#e78284">int</span>, p <span style="color:#e78284">int</span>) { <span style="color:#737994;font-style:italic">// 对 nums[p:] 进行排序
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>     sort.<span style="color:#8caaee">Slice</span>(nums[p:], <span style="color:#e78284">func</span>(i, j <span style="color:#e78284">int</span>) <span style="color:#e78284">bool</span> {
</span></span><span style="display:flex;"><span>         <span style="color:#ca9ee6">return</span> nums[i] &lt; nums[j]
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>咋一看没什么问题，跑下测试用例吧：</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#e78284">func</span> <span style="color:#8caaee">main</span>() {
</span></span><span style="display:flex;"><span>	nums <span style="color:#99d1db;font-weight:bold">:=</span> []<span style="color:#e78284">int</span>{<span style="color:#ef9f76">2</span>, <span style="color:#ef9f76">3</span>, <span style="color:#ef9f76">1</span>, <span style="color:#ef9f76">5</span>, <span style="color:#ef9f76">4</span>, <span style="color:#ef9f76">6</span>, <span style="color:#ef9f76">7</span>}
</span></span><span style="display:flex;"><span>	tests <span style="color:#99d1db;font-weight:bold">:=</span> []<span style="color:#e78284">struct</span> {
</span></span><span style="display:flex;"><span>		p    <span style="color:#e78284">int</span>
</span></span><span style="display:flex;"><span>		want []<span style="color:#e78284">int</span>
</span></span><span style="display:flex;"><span>	}{
</span></span><span style="display:flex;"><span>		{p: <span style="color:#ef9f76">1</span>, want: []<span style="color:#e78284">int</span>{<span style="color:#ef9f76">2</span>, <span style="color:#ef9f76">1</span>, <span style="color:#ef9f76">3</span>, <span style="color:#ef9f76">4</span>, <span style="color:#ef9f76">5</span>, <span style="color:#ef9f76">6</span>, <span style="color:#ef9f76">7</span>}},
</span></span><span style="display:flex;"><span>		{p: <span style="color:#ef9f76">2</span>, want: []<span style="color:#e78284">int</span>{<span style="color:#ef9f76">2</span>, <span style="color:#ef9f76">3</span>, <span style="color:#ef9f76">1</span>, <span style="color:#ef9f76">4</span>, <span style="color:#ef9f76">5</span>, <span style="color:#ef9f76">6</span>, <span style="color:#ef9f76">7</span>}},
</span></span><span style="display:flex;"><span>		{p: <span style="color:#ef9f76">3</span>, want: []<span style="color:#e78284">int</span>{<span style="color:#ef9f76">2</span>, <span style="color:#ef9f76">3</span>, <span style="color:#ef9f76">1</span>, <span style="color:#ef9f76">4</span>, <span style="color:#ef9f76">5</span>, <span style="color:#ef9f76">6</span>, <span style="color:#ef9f76">7</span>}},
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">for</span> _, tt <span style="color:#99d1db;font-weight:bold">:=</span> <span style="color:#ca9ee6">range</span> tests {
</span></span><span style="display:flex;"><span>		got <span style="color:#99d1db;font-weight:bold">:=</span> slices.<span style="color:#8caaee">Clone</span>(nums) <span style="color:#737994;font-style:italic">// 拷贝原始数据，用于测试
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>		<span style="color:#8caaee">SortAfter</span>(got, tt.p)
</span></span><span style="display:flex;"><span>		<span style="color:#ca9ee6">if</span> !reflect.<span style="color:#8caaee">DeepEqual</span>(got, tt.want) {
</span></span><span style="display:flex;"><span>			fmt.<span style="color:#8caaee">Printf</span>(<span style="color:#a6d189">&#34;when p: %v ,want: %v, but got: %v\n&#34;</span>, tt.p, tt.want, got)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// Output:
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// when p: 1 ,want: [2 1 3 4 5 6 7], but got: [2 3 5 6 7 4 1]
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// when p: 3 ,want: [2 3 1 4 5 6 7], but got: [2 3 1 5 6 4 7]
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>为什么 p = 1,3 时不对，p = 2 时又是对的呢？
因为 sort.Slices 接收到的参数是 <code>nums[p:]</code>，<code>less</code> 闭包里的参数 <code>i, j</code> 是在 <code>nums[p:]</code> 的位置，如果直接比较 <code>nums[i]</code> 和<code>nums[j]</code>，那就忽略了 <code>p</code> 偏移的影响，所以实际要比较的元素其实是 <code>nums[i+p]</code> 和 <code>nums[j+p]</code>，那么修复后的函数：</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#e78284">func</span> <span style="color:#8caaee">SortAfter</span>(nums []<span style="color:#e78284">int</span>, p <span style="color:#e78284">int</span>) { <span style="color:#737994;font-style:italic">// 从p开始排序
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>	sort.<span style="color:#8caaee">Slice</span>(nums[p:], <span style="color:#e78284">func</span>(i, j <span style="color:#e78284">int</span>) <span style="color:#e78284">bool</span> { <span style="color:#737994;font-style:italic">// 这里传入的slice不再是完整的nums，而是nums[p:]
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>		<span style="color:#ca9ee6">return</span> nums[i<span style="color:#99d1db;font-weight:bold">+</span>p] &lt; nums[j<span style="color:#99d1db;font-weight:bold">+</span>p]
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="使用-slicessort-优化">使用 slices.Sort 优化</h2>
<p>手动修正偏移量，可以避免部分排序这个坑一时，但日后依旧有可能因为思维惯性而导致再次踩坑。具体实现也很别扭，也不方便修改。</p>
<p>好在 go 在 1.21 版本新增了了 <code>slices</code> 这个泛型库，里面包含了很多切片的通用操作，其中的 <code>slices.Sort</code> 和  <code>slices.SortFunc</code> 函数就可以避免上面的坑。</p>
<p>这两个函数的签名：</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#e78284">func</span> Sort[S <span style="color:#e78284">~</span>[]E, E cmp.Ordered](x S)
</span></span><span style="display:flex;"><span><span style="color:#e78284">func</span> SortFunc[S <span style="color:#e78284">~</span>[]E, E any](x S, cmp <span style="color:#e78284">func</span>(a, b E) <span style="color:#e78284">int</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用方法也很简单，直接传入要排序的部分，如果调用 <code>slices.Sort</code>，还可以省去用手写 <code>less</code> 闭包函数。
最重要的是，按照直觉使用这两个函数就可以避免 <code>sort.Slices</code> 在部分排序时的坑：</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#e78284">func</span> <span style="color:#8caaee">main</span>() {
</span></span><span style="display:flex;"><span>	nums <span style="color:#99d1db;font-weight:bold">:=</span> []<span style="color:#e78284">int</span>{<span style="color:#ef9f76">2</span>, <span style="color:#ef9f76">3</span>, <span style="color:#ef9f76">1</span>, <span style="color:#ef9f76">5</span>, <span style="color:#ef9f76">4</span>, <span style="color:#ef9f76">6</span>, <span style="color:#ef9f76">7</span>}
</span></span><span style="display:flex;"><span>	tests <span style="color:#99d1db;font-weight:bold">:=</span> []<span style="color:#e78284">struct</span> {
</span></span><span style="display:flex;"><span>		p    <span style="color:#e78284">int</span>
</span></span><span style="display:flex;"><span>		want []<span style="color:#e78284">int</span>
</span></span><span style="display:flex;"><span>	}{
</span></span><span style="display:flex;"><span>		{p: <span style="color:#ef9f76">0</span>, want: []<span style="color:#e78284">int</span>{<span style="color:#ef9f76">1</span>, <span style="color:#ef9f76">2</span>, <span style="color:#ef9f76">3</span>, <span style="color:#ef9f76">4</span>, <span style="color:#ef9f76">5</span>, <span style="color:#ef9f76">6</span>, <span style="color:#ef9f76">7</span>}},
</span></span><span style="display:flex;"><span>		{p: <span style="color:#ef9f76">1</span>, want: []<span style="color:#e78284">int</span>{<span style="color:#ef9f76">2</span>, <span style="color:#ef9f76">1</span>, <span style="color:#ef9f76">3</span>, <span style="color:#ef9f76">4</span>, <span style="color:#ef9f76">5</span>, <span style="color:#ef9f76">6</span>, <span style="color:#ef9f76">7</span>}},
</span></span><span style="display:flex;"><span>		{p: <span style="color:#ef9f76">2</span>, want: []<span style="color:#e78284">int</span>{<span style="color:#ef9f76">2</span>, <span style="color:#ef9f76">3</span>, <span style="color:#ef9f76">1</span>, <span style="color:#ef9f76">4</span>, <span style="color:#ef9f76">5</span>, <span style="color:#ef9f76">6</span>, <span style="color:#ef9f76">7</span>}},
</span></span><span style="display:flex;"><span>		{p: <span style="color:#ef9f76">3</span>, want: []<span style="color:#e78284">int</span>{<span style="color:#ef9f76">2</span>, <span style="color:#ef9f76">3</span>, <span style="color:#ef9f76">1</span>, <span style="color:#ef9f76">4</span>, <span style="color:#ef9f76">5</span>, <span style="color:#ef9f76">6</span>, <span style="color:#ef9f76">7</span>}},
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">for</span> _, tt <span style="color:#99d1db;font-weight:bold">:=</span> <span style="color:#ca9ee6">range</span> tests {
</span></span><span style="display:flex;"><span>		got <span style="color:#99d1db;font-weight:bold">:=</span> slices.<span style="color:#8caaee">Clone</span>(nums) <span style="color:#737994;font-style:italic">// 拷贝原始数据，用于测试
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>		slices.<span style="color:#8caaee">Sort</span>(got[tt.p:])
</span></span><span style="display:flex;"><span>		<span style="color:#ca9ee6">if</span> !reflect.<span style="color:#8caaee">DeepEqual</span>(got, tt.want) {
</span></span><span style="display:flex;"><span>			fmt.<span style="color:#8caaee">Printf</span>(<span style="color:#a6d189">&#34;when p: %v ,want: %v, but got: %v\n&#34;</span>, tt.p, tt.want, got)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>而使用 <code>sort.SortFunc</code>，搭配 go 1.22 新增的泛型函数 <code>cmp.Or</code>，可以更轻松的实现多字段排序，这段代码来自 <a href="https://github.com/golang/go/blob/78755f6b8c5f18b0014e9dcac383898047ff14fe/src/cmp/cmp_test.go#L144-L177">go1.22 标准库 <code>cmp/cmp_test.go</code></a>：</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#e78284">func</span> <span style="color:#8caaee">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">type</span> Order <span style="color:#e78284">struct</span> {
</span></span><span style="display:flex;"><span>		Product  <span style="color:#e78284">string</span>
</span></span><span style="display:flex;"><span>		Customer <span style="color:#e78284">string</span>
</span></span><span style="display:flex;"><span>		Price    <span style="color:#e78284">float64</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	orders <span style="color:#99d1db;font-weight:bold">:=</span> []Order{
</span></span><span style="display:flex;"><span>		{<span style="color:#a6d189">&#34;foo&#34;</span>, <span style="color:#a6d189">&#34;alice&#34;</span>, <span style="color:#ef9f76">1.00</span>},
</span></span><span style="display:flex;"><span>		{<span style="color:#a6d189">&#34;bar&#34;</span>, <span style="color:#a6d189">&#34;bob&#34;</span>, <span style="color:#ef9f76">3.00</span>},
</span></span><span style="display:flex;"><span>		{<span style="color:#a6d189">&#34;baz&#34;</span>, <span style="color:#a6d189">&#34;carol&#34;</span>, <span style="color:#ef9f76">4.00</span>},
</span></span><span style="display:flex;"><span>		{<span style="color:#a6d189">&#34;foo&#34;</span>, <span style="color:#a6d189">&#34;alice&#34;</span>, <span style="color:#ef9f76">2.00</span>},
</span></span><span style="display:flex;"><span>		{<span style="color:#a6d189">&#34;bar&#34;</span>, <span style="color:#a6d189">&#34;carol&#34;</span>, <span style="color:#ef9f76">1.00</span>},
</span></span><span style="display:flex;"><span>		{<span style="color:#a6d189">&#34;foo&#34;</span>, <span style="color:#a6d189">&#34;bob&#34;</span>, <span style="color:#ef9f76">4.00</span>},
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#737994;font-style:italic">// Sort by customer first, product second, and last by higher price
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span>	slices.<span style="color:#8caaee">SortFunc</span>(orders, <span style="color:#e78284">func</span>(a, b Order) <span style="color:#e78284">int</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#ca9ee6">return</span> cmp.<span style="color:#8caaee">Or</span>(
</span></span><span style="display:flex;"><span>			cmp.<span style="color:#8caaee">Compare</span>(a.Customer, b.Customer),
</span></span><span style="display:flex;"><span>			cmp.<span style="color:#8caaee">Compare</span>(a.Product, b.Product),
</span></span><span style="display:flex;"><span>			cmp.<span style="color:#8caaee">Compare</span>(b.Price, a.Price),
</span></span><span style="display:flex;"><span>		)
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">for</span> _, order <span style="color:#99d1db;font-weight:bold">:=</span> <span style="color:#ca9ee6">range</span> orders {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#8caaee">Printf</span>(<span style="color:#a6d189">&#34;%s %s %.2f\n&#34;</span>, order.Product, order.Customer, order.Price)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// Output:
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// foo alice 2.00
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// foo alice 1.00
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// bar bob 3.00
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// foo bob 4.00
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// bar carol 1.00
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// baz carol 4.00
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>其中 <a href="https://github.com/golang/go/blob/78755f6b8c5f18b0014e9dcac383898047ff14fe/src/cmp/cmp.go#L61-L71"><code>cmp.Or</code> 的源码</a> 非常简单，只是用于找出切片中第一个非零的元素：</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// Or returns the first of its arguments that is not equal to the zero value.
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic">// If no argument is non-zero, it returns the zero value.
</span></span></span><span style="display:flex;"><span><span style="color:#737994;font-style:italic"></span><span style="color:#e78284">func</span> Or[T comparable](vals <span style="color:#99d1db;font-weight:bold">...</span>T) T {
</span></span><span style="display:flex;"><span>	<span style="color:#e78284">var</span> zero T
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">for</span> _, val <span style="color:#99d1db;font-weight:bold">:=</span> <span style="color:#ca9ee6">range</span> vals {
</span></span><span style="display:flex;"><span>		<span style="color:#ca9ee6">if</span> val <span style="color:#99d1db;font-weight:bold">!=</span> zero {
</span></span><span style="display:flex;"><span>			<span style="color:#ca9ee6">return</span> val
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ca9ee6">return</span> zero
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到，这样写 <code>less</code> 函数，比手写多个 <code>if</code> 优雅太多了。</p>
<h2 id="参考资料">参考资料</h2>
<ul>
<li><a href="https://www.jianshu.com/p/b634b629db03">golang sort.Slice踩坑记录 - 简书</a></li>
</ul>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">最后修改于 2024-03-11</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts">
			下回<br>已经到头啦。
                </a>
                
                
                
                <a class="older-posts" href="/posts/lc2522.-%E7%BB%9F%E8%AE%A1%E4%B8%8A%E5%8D%87%E5%9B%9B%E5%85%83%E7%BB%84/">
			上回<br>LC2522. 统计上升四元组
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                












<script src="https://giscus.app/client.js"
        data-repo="username/repo"
        data-repo-id="**************************"
        data-category="General"
        data-category-id="*********************"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>

            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://niluan304.github.io/">
    
        <div class="nav-title">
            雾封的笔
        </div>
        
        <div class="nav-subtitle">
            脚步不停，灿若繁星。
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS Feed
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	雾封 本站遵循 CC-BY-NC 4.0 协议
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#sortslices-%e4%bb%8b%e7%bb%8d" class="nav-sortslices-介绍">
									sort.Slices 介绍
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%97%ad%e5%8c%85%e7%9a%84%e5%9d%91" class="nav-闭包的坑">
									闭包的坑
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8-slicessort-%e4%bc%98%e5%8c%96" class="nav-使用-slicessort-优化">
									使用 slices.Sort 优化
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99" class="nav-参考资料">
									参考资料
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	雾封 本站遵循 CC-BY-NC 4.0 协议
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
